<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê²°íˆ¬ì¥ ë± ê³µìœ  | ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ PVP ë± ì¶”ì²œ</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ê²°íˆ¬ì¥ ë± ì¶”ì²œ í”Œë«í¼. ì§„í˜•ë³„ 5ëª…ì˜ ì˜ì›…ìœ¼ë¡œ ê²°íˆ¬ì¥ ë± ì¶”ì²œ, ì´ë ¥ì „ ë± ì¡°í•©, ê¸¸ë“œì „ ë± ì¶”ì²œì„ í™•ì¸í•˜ê³  ë‚˜ë§Œì˜ ìµœê°• ë±ì„ ê³µìœ í•˜ì„¸ìš”.">
    <meta name="keywords" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤, ì„¸ë‚˜ ë¦¬ë²„ìŠ¤, ê²°íˆ¬ì¥ ë± ì¶”ì²œ, ì´ë ¥ì „ ë± ì¶”ì²œ, ê¸¸ë“œì „ ë± ì¶”ì²œ, ë ˆì´ë“œ ë± ì¶”ì²œ, ê²°íˆ¬ì¥ ê³µëµ, ì´ë ¥ì „ ê³µëµ, ê¸¸ë“œì „ ê³µëµ, ê²°ì¥ ë±, PVP ë±, ì˜ì›… ì¡°í•©, ë± ì¡°í•©, ë± ê³µìœ , ì§„í˜•, ì•„ë ˆë‚˜, ìµœê°• ë±, ë©”íƒ€ ë±, Seven Knights Rebirth deck, ì„¸ë‚˜ ë±">
    <meta name="author" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ê°€ì´ë“œë¶">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="ê²°íˆ¬ì¥ ë± ê³µìœ  | ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ PVP ë± ì¶”ì²œ">
    <meta property="og:description" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ê²°íˆ¬ì¥ ë± ì¶”ì²œ í”Œë«í¼. ì§„í˜•ë³„ ì˜ì›… ì¡°í•©ìœ¼ë¡œ ê²°íˆ¬ì¥, ì´ë ¥ì „, ê¸¸ë“œì „ ìµœê°• ë±ì„ êµ¬ì„±í•˜ê³  ê³µìœ í•˜ì„¸ìš”.">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ê°€ì´ë“œë¶">
    <link rel="canonical" href="https://sena-rebirth-guidebook.app/deck.html" />
    <link rel="stylesheet" href="/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DMD8LXSEQ5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-DMD8LXSEQ5');
    </script>
  </head>
  <body>
    <div class="layout">
      <header class="header">
        <div class="header-left">
          <button class="hamburger-menu" id="hamburger-menu" aria-label="ë©”ë‰´">
            <i class="ph-bold ph-list"></i>
          </button>
          <img src="/favicon.ico" alt="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ë¡œê³ " class="header-logo" />
          <div class="header-title">ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ê°€ì´ë“œë¶</div>
        </div>
        <div class="header-actions">
          <button class="theme-toggle" id="theme-toggle" aria-label="í…Œë§ˆ ì „í™˜">
            <i class="ph-bold ph-sun" id="theme-icon"></i>
            <span id="theme-text">ë¼ì´íŠ¸ ëª¨ë“œ</span>
          </button>
        </div>
      </header>

      <!-- Mobile Menu Overlay -->
      <div class="mobile-menu-overlay" id="mobile-menu-overlay">
        <div class="mobile-menu">
          <div class="mobile-menu-header">
            <img src="/favicon.ico" alt="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ë¡œê³ " class="mobile-menu-logo" />
            <span>ë©”ë‰´</span>
            <button class="mobile-menu-close" id="mobile-menu-close" aria-label="ë‹«ê¸°">
              <i class="ph-bold ph-x"></i>
            </button>
          </div>
          <nav class="mobile-menu-nav">
            <a href="/index.html" class="mobile-nav-link">
              <i class="ph-bold ph-users-three"></i>
              <span>ì˜ì›… ë„ê°</span>
            </a>
            <a href="/deck.html" class="mobile-nav-link active">
              <i class="ph-bold ph-sword"></i>
              <span>ê²°íˆ¬ì¥ ë±</span>
            </a>
          </nav>
        </div>
      </div>

      <aside class="sidebar-left">
        <nav>
          <ul>
            <li><a href="/index.html">ì˜ì›… ë„ê°</a></li>
            <li class="active">ê²°íˆ¬ì¥ ë±</li>
          </ul>
        </nav>
      </aside>

      <main class="content deck-content">
        <h1>ê²°íˆ¬ì¥ ë± ê³µìœ </h1>
        <p class="subtitle">ë‚˜ë§Œì˜ ê²°íˆ¬ì¥ ë±ì„ êµ¬ì„±í•˜ê³  ê³µìœ í•˜ì„¸ìš”</p>

        <div class="deck-layout">
          <!-- ì¤‘ì•™: ì§„í˜• ì„ íƒ + ë± ë°°ì¹˜ ì˜ì—­ -->
          <div class="deck-left">
            <!-- ì§„í˜• ì„ íƒ -->
            <div class="formation-selector">
              <h3>ì§„í˜• ì„ íƒ</h3>
              <div class="formation-options">
                <label class="formation-option active">
                  <input type="radio" name="formation" value="default" checked>
                  <span class="formation-name">ê¸°ë³¸</span>
                </label>
                <label class="formation-option">
                  <input type="radio" name="formation" value="balance">
                  <span class="formation-name">ë°¸ëŸ°ìŠ¤</span>
                </label>
                <label class="formation-option">
                  <input type="radio" name="formation" value="attack">
                  <span class="formation-name">ê³µê²©</span>
                </label>
                <label class="formation-option">
                  <input type="radio" name="formation" value="defense">
                  <span class="formation-name">ë³´í˜¸</span>
                </label>
              </div>
            </div>

            <!-- ë± ë°°ì¹˜ -->
            <div class="deck-display">
              <h2>ë‚˜ì˜ ë±</h2>
              <div class="deck-formation">
                <!-- ë’·ì¤„ (ì™¼ìª½) -->
                <div class="formation-line back-line">
                  <div class="line-label">ë’·ì¤„ (BACK)</div>
                  <div id="back-slots" class="formation-slots"></div>
                </div>

                <!-- ì•ì¤„ (ì˜¤ë¥¸ìª½) -->
                <div class="formation-line front-line">
                  <div class="line-label">ì•ì¤„ (FRONT)</div>
                  <div id="front-slots" class="formation-slots"></div>
                </div>
              </div>

              <!-- ë± ì•¡ì…˜ ë²„íŠ¼ -->
              <div class="deck-actions">
                <button id="clear-deck" class="btn-secondary">
                  <i class="ph ph-trash"></i> ë± ì´ˆê¸°í™”
                </button>
                <button id="share-deck" class="btn-primary">
                  <i class="ph ph-share-network"></i> ë± ê³µìœ í•˜ê¸°
                </button>
              </div>
            </div>
          </div>

          <!-- ìš°ì¸¡: ì˜ì›… ì„ íƒ ì˜ì—­ -->
          <div class="deck-right">
            <div class="hero-selection-header">
              <h2>ì˜ì›… ì„ íƒ</h2>
              <div class="selection-info">
                <span id="selected-count">0/5</span> ëª… ì„ íƒë¨
              </div>
            </div>

            <!-- í•„í„° (ì»´íŒ©íŠ¸ ê°€ë¡œ) -->
            <div class="filters-compact">
              <input type="text" id="search-hero" class="search-input" placeholder="ğŸ” ì˜ì›… ì´ë¦„ ê²€ìƒ‰..." />

              <select id="filter-rarity" class="filter-select">
                <option value="ì „ì²´">ë“±ê¸‰: ì „ì²´</option>
                <option value="ì „ì„¤+">ì „ì„¤+</option>
                <option value="ì „ì„¤">ì „ì„¤</option>
                <option value="í¬ê·€">í¬ê·€</option>
              </select>

              <select id="filter-type" class="filter-select">
                <option value="ì „ì²´">íƒ€ì…: ì „ì²´</option>
                <option value="ê³µê²©í˜•">ê³µê²©í˜•</option>
                <option value="ë§ˆë²•í˜•">ë§ˆë²•í˜•</option>
                <option value="ë§ŒëŠ¥í˜•">ë§ŒëŠ¥í˜•</option>
                <option value="ë°©ì–´í˜•">ë°©ì–´í˜•</option>
                <option value="ì§€ì›í˜•">ì§€ì›í˜•</option>
              </select>
            </div>

            <!-- ì˜ì›… ëª©ë¡ -->
            <div id="heroes-list"></div>
          </div>
        </div>
      </main>
    </div>

    <!-- ê³µìœ  ëª¨ë‹¬ -->
    <div id="share-modal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ë± ê³µìœ í•˜ê¸°</h3>
          <button class="modal-close" id="close-modal">Ã—</button>
        </div>
        <div class="modal-body">
          <p>ì´ URLì„ ë³µì‚¬í•˜ì—¬ ë‹¤ë¥¸ ì‚¬ëŒê³¼ ê³µìœ í•˜ì„¸ìš”:</p>
          <div class="share-url-container">
            <input type="text" id="share-url" readonly />
            <button id="copy-url" class="btn-primary">
              <i class="ph ph-copy"></i> ë³µì‚¬
            </button>
          </div>
          <div id="copy-success" class="success-message" style="display: none;">
            âœ“ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!
          </div>
        </div>
      </div>
    </div>

    <!-- ì˜ì›… ì„ íƒ ëª¨ë‹¬ -->
    <div id="hero-select-modal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ì˜ì›… ì„ íƒ</h3>
          <button class="modal-close" id="close-hero-select">Ã—</button>
        </div>
        <div class="modal-body">
          <!-- í•„í„° -->
          <div class="hero-select-filters">
            <input type="text" id="modal-search-hero" class="search-input" placeholder="ğŸ” ì˜ì›… ì´ë¦„ ê²€ìƒ‰..." />
            <select id="modal-filter-rarity" class="filter-select">
              <option value="ì „ì²´">ë“±ê¸‰: ì „ì²´</option>
              <option value="ì „ì„¤+">ì „ì„¤+</option>
              <option value="ì „ì„¤">ì „ì„¤</option>
              <option value="í¬ê·€">í¬ê·€</option>
            </select>
            <select id="modal-filter-type" class="filter-select">
              <option value="ì „ì²´">íƒ€ì…: ì „ì²´</option>
              <option value="ê³µê²©í˜•">ê³µê²©í˜•</option>
              <option value="ë§ˆë²•í˜•">ë§ˆë²•í˜•</option>
              <option value="ë§ŒëŠ¥í˜•">ë§ŒëŠ¥í˜•</option>
              <option value="ë°©ì–´í˜•">ë°©ì–´í˜•</option>
              <option value="ì§€ì›í˜•">ì§€ì›í˜•</option>
            </select>
          </div>

          <!-- ì˜ì›… ê·¸ë¦¬ë“œ -->
          <div id="modal-heroes-grid" class="hero-select-grid"></div>
        </div>
      </div>
    </div>

    <!-- Global Loading Overlay -->
    <div id="global-loading" class="loading-container" aria-hidden="true" style="display:flex;">
      <div class="spinner"></div>
      <div class="loading-text">L O A D I N G</div>
    </div>

    <script>
      let allHeroes = [];
      let selectedHeroes = {
        front: [null, null], // ê¸°ë³¸ ì§„í˜•: ì•ì¤„ 2
        back: [null, null, null] // ê¸°ë³¸ ì§„í˜•: ë’·ì¤„ 3
      };
      const MAX_DECK_SIZE = 5;
      let currentSelectingSlot = null; // { line: 'front'|'back', index: number }

      // ì§„í˜• ì„¤ì •
      const formations = {
        default: { front: 2, back: 3 },
        balance: { front: 3, back: 2 },
        attack: { front: 1, back: 4 },
        defense: { front: 4, back: 1 }
      };
      let currentFormation = 'default';

      function showLoading(on) {
        const el = document.getElementById("global-loading");
        if (!el) return;
        el.style.display = on ? "flex" : "none";
      }

      // ì§„í˜•ì— ë”°ë¼ ìŠ¬ë¡¯ ìƒì„±
      function createFormationSlots() {
        const formation = formations[currentFormation];
        const frontContainer = document.getElementById('front-slots');
        const backContainer = document.getElementById('back-slots');

        // ë’·ì¤„ ìŠ¬ë¡¯ ìƒì„±
        backContainer.innerHTML = '';
        for (let i = 0; i < formation.back; i++) {
          const slot = document.createElement('div');
          slot.className = 'deck-slot back-slot';
          slot.dataset.line = 'back';
          slot.dataset.position = i;
          slot.innerHTML = `
            <div class="slot-indicator">B</div>
            <div class="slot-placeholder">+</div>
          `;

          // ìŠ¬ë¡¯ í´ë¦­ ì´ë²¤íŠ¸
          slot.addEventListener('click', () => {
            openHeroSelectModal('back', i);
          });

          backContainer.appendChild(slot);
        }

        // ì•ì¤„ ìŠ¬ë¡¯ ìƒì„±
        frontContainer.innerHTML = '';
        for (let i = 0; i < formation.front; i++) {
          const slot = document.createElement('div');
          slot.className = 'deck-slot front-slot';
          slot.dataset.line = 'front';
          slot.dataset.position = i;
          slot.innerHTML = `
            <div class="slot-indicator">F</div>
            <div class="slot-placeholder">+</div>
          `;

          // ìŠ¬ë¡¯ í´ë¦­ ì´ë²¤íŠ¸
          slot.addEventListener('click', () => {
            openHeroSelectModal('front', i);
          });

          frontContainer.appendChild(slot);
        }

        // ê¸°ì¡´ ì„ íƒëœ ì˜ì›…ì„ ìƒˆ ì§„í˜•ì— ë§ê²Œ ì¬ë°°ì¹˜
        redistributeHeroes();
        updateDeckDisplay();
      }

      // ì§„í˜• ë³€ê²½ ì‹œ ì˜ì›… ì¬ë°°ì¹˜
      function redistributeHeroes() {
        const formation = formations[currentFormation];
        const allSelected = [...selectedHeroes.front, ...selectedHeroes.back].filter(h => h);

        selectedHeroes.front = new Array(formation.front).fill(null);
        selectedHeroes.back = new Array(formation.back).fill(null);

        // ì˜ì›…ë“¤ì„ ë‹¤ì‹œ ë°°ì¹˜
        allSelected.forEach((hero, index) => {
          if (index < formation.front) {
            selectedHeroes.front[index] = hero;
          } else if (index < formation.front + formation.back) {
            selectedHeroes.back[index - formation.front] = hero;
          }
        });
      }

      // ì˜ì›… ì„ íƒ ëª¨ë‹¬ ì—´ê¸°
      function openHeroSelectModal(line, index) {
        currentSelectingSlot = { line, index };
        document.getElementById('hero-select-modal').style.display = 'flex';
        renderModalHeroes(allHeroes);
      }

      // ì˜ì›… ì„ íƒ ëª¨ë‹¬ ë‹«ê¸°
      function closeHeroSelectModal() {
        document.getElementById('hero-select-modal').style.display = 'none';
        currentSelectingSlot = null;

        // í•„í„° ì´ˆê¸°í™”
        document.getElementById('modal-search-hero').value = '';
        document.getElementById('modal-filter-rarity').value = 'ì „ì²´';
        document.getElementById('modal-filter-type').value = 'ì „ì²´';
      }

      // ëª¨ë‹¬ì—ì„œ ì˜ì›… ì„ íƒ
      function selectHeroFromModal(hero) {
        if (!currentSelectingSlot) return;

        const { line, index } = currentSelectingSlot;

        // í•´ë‹¹ ìŠ¬ë¡¯ì— ì˜ì›… ë°°ì¹˜
        selectedHeroes[line][index] = hero;

        updateDeckDisplay();
        closeHeroSelectModal();
      }

      // ëª¨ë‹¬ì— ì˜ì›… ëª©ë¡ ë Œë”ë§
      function renderModalHeroes(heroes) {
        const grid = document.getElementById('modal-heroes-grid');
        grid.innerHTML = '';

        heroes.forEach((hero) => {
          const card = document.createElement('div');
          card.className = 'hero-card';

          if (hero.group && hero.group.includes("(êµ¬)ì„¸ë¸ë‚˜ì´ì¸ ")) {
            card.classList.add("old-sevenknights");
          }

          // ì´ˆìƒ ì´ë¯¸ì§€ì™€ íƒ€ì… ë°°ì§€
          if (hero.portrait) {
            const imgWrapper = document.createElement("div");
            imgWrapper.className = "hero-portrait-wrap";
            imgWrapper.style.position = "relative";

            const img = document.createElement("img");
            img.src = hero.portrait;
            img.alt = hero.name || "ì´ë¯¸ì§€ ì—†ìŒ";
            const rarityClass = getRarityClass(hero.rarity);
            img.className = `hero-portrait rarity-${rarityClass}`;
            if (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1) {
              img.classList.add("has-effect");
            }
            imgWrapper.appendChild(img);

            // ë‹¤ì´ì•„ëª¬ë“œ íš¨ê³¼
            if (hero.hasEffect) {
              const gradientId = `paint0_diamond_modal_${hero.name.replace(/\s/g, '')}_${hero.id}`;
              const starWrapper = document.createElement("div");
              starWrapper.className = "rarity-diamond-effect";
              starWrapper.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 100" fill="none">
                  <defs>
                    <linearGradient id="${gradientId}" x1="0" y1="0" x2="500" y2="500" gradientUnits="userSpaceOnUse">
                      <stop stop-color="#FFF8E1"/>
                      <stop offset="0.533654" stop-color="#FFE082"/>
                      <stop offset="1" stop-color="#FFB300"/>
                    </linearGradient>
                  </defs>
                  <path d="M99.0854 0.124826C99.6876 -0.259713 100.26 0.312411 99.8752 0.914611C74.5556 40.6083 73.1362 54.5342 90.8173 89.847C91.0858 90.3826 90.384 91.0844 89.8483 90.816L89.847 90.8174C54.5329 73.1375 40.6072 74.5546 0.914577 99.8752C0.312412 100.26 -0.259673 99.6876 0.124792 99.0854C25.4444 59.3918 26.8625 45.4671 9.18167 10.1521C8.9215 9.63314 9.57223 8.95807 10.1001 9.16059L10.1507 9.18308C45.4657 26.8639 59.3905 25.4457 99.0854 0.124826ZM65.703 34.2974C61.9959 35.3198 58.2999 36.037 54.5685 36.4171C48.0147 37.0846 41.7138 36.6839 35.4457 35.4467C36.6829 41.7148 37.0837 48.0156 36.4162 54.5693C36.0363 58.3003 35.3191 61.996 34.2969 65.7027C38.0036 64.6805 41.6993 63.9633 45.4303 63.5834C51.9843 62.9159 58.2853 63.3166 64.5537 64.5539C63.3165 58.2856 62.9157 51.9848 63.5833 45.4307C63.9634 41.6997 64.6808 38.0041 65.703 34.2974Z" fill="url(#${gradientId})"/>
                </svg>
              `;

              try {
                const stops = starWrapper.querySelectorAll(`#${gradientId} stop`);
                if (stops && stops.length >= 3) {
                  const isOldSeven = hero.group && hero.group.trim().includes("(êµ¬)ì„¸ë¸ë‚˜ì´ì¸ ");
                  if (isOldSeven) {
                    stops[0].setAttribute("stop-color", "#EEDBFF");
                    stops[1].setAttribute("stop-color", "#C49CFF");
                    stops[2].setAttribute("stop-color", "#9C6BFF");
                  } else {
                    stops[0].setAttribute("stop-color", "#FFF8E1");
                    stops[1].setAttribute("stop-color", "#FFE082");
                    stops[2].setAttribute("stop-color", "#FFB300");
                  }
                }
              } catch (e) {
                console.warn("ê·¸ë¼ë””ì–¸íŠ¸ ì ìš© ì‹¤íŒ¨:", e);
              }

              imgWrapper.appendChild(starWrapper);
            }

            if (hero.typeImage) {
              const typeBadge = document.createElement("img");
              typeBadge.src = hero.typeImage;
              typeBadge.alt = hero.type || "íƒ€ì… ë°°ì§€";
              typeBadge.className = "hero-type-badge";
              imgWrapper.appendChild(typeBadge);
            }

            card.appendChild(imgWrapper);
          }

          const name = document.createElement("div");
          name.className = "hero-name";
          name.textContent = hero.name || "ì´ë¦„ ì—†ìŒ";
          card.appendChild(name);

          if (hero.nickname) {
            const nickname = document.createElement("div");
            nickname.className = "hero-nickname";
            nickname.textContent = `${hero.nickname}`;
            card.appendChild(nickname);
          }

          // ì„ íƒ ì´ë²¤íŠ¸
          card.addEventListener("click", () => {
            selectHeroFromModal(hero);
          });

          grid.appendChild(card);
        });
      }

      // ëª¨ë‹¬ í•„í„° ì ìš©
      function applyModalFilters() {
        const searchTerm = document.getElementById('modal-search-hero').value.toLowerCase();
        const selectedRarity = document.getElementById('modal-filter-rarity').value;
        const selectedType = document.getElementById('modal-filter-type').value;

        let filtered = allHeroes.filter(hero => {
          const nameMatch = !searchTerm || hero.name.toLowerCase().includes(searchTerm);
          const rarityMatch = selectedRarity === "ì „ì²´" || selectedRarity === hero.rarity;
          const typeMatch = selectedType === "ì „ì²´" || selectedType === hero.type;
          return nameMatch && rarityMatch && typeMatch;
        });

        return filtered.sort((a, b) => a.name.localeCompare(b, "ko"));
      }

      // ì˜ì›… ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      async function fetchHeroes() {
        showLoading(true);
        try {
          const response = await fetch("/api/heroes");
          const data = await response.json();
          if (!data.records || !Array.isArray(data.records)) {
            console.error("ì„œë²„ ì‘ë‹µ:", data);
            return;
          }
          allHeroes = data.records;

          // ì§„í˜• ìŠ¬ë¡¯ ìƒì„±
          createFormationSlots();

          setupModalFilters();
          setupFormationSelector();
        } catch (error) {
          console.error("ì—ëŸ¬:", error);
          alert("ì˜ì›… ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        } finally {
          showLoading(false);
        }
      }

      // ì§„í˜• ì„ íƒê¸° ì„¤ì •
      function setupFormationSelector() {
        document.querySelectorAll('input[name="formation"]').forEach(radio => {
          radio.addEventListener('change', (e) => {
            currentFormation = e.target.value;

            // UI ì—…ë°ì´íŠ¸
            document.querySelectorAll('.formation-option').forEach(opt => opt.classList.remove('active'));
            e.target.closest('.formation-option').classList.add('active');

            // ìŠ¬ë¡¯ ì¬ìƒì„±
            createFormationSlots();
          });
        });
      }

      // ëª¨ë‹¬ í•„í„° ì´ë²¤íŠ¸ ì„¤ì •
      function setupModalFilters() {
        document.getElementById('modal-search-hero').addEventListener('input', () => {
          const filtered = applyModalFilters();
          renderModalHeroes(filtered);
        });

        document.getElementById('modal-filter-rarity').addEventListener('change', () => {
          const filtered = applyModalFilters();
          renderModalHeroes(filtered);
        });

        document.getElementById('modal-filter-type').addEventListener('change', () => {
          const filtered = applyModalFilters();
          renderModalHeroes(filtered);
        });

        // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
        document.getElementById('close-hero-select').addEventListener('click', closeHeroSelectModal);

        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸°
        document.getElementById('hero-select-modal').addEventListener('click', (e) => {
          if (e.target.id === 'hero-select-modal') {
            closeHeroSelectModal();
          }
        });
      }

      // ì˜ì›… ëª©ë¡ ë Œë”ë§ (ì‚¬ìš©í•˜ì§€ ì•ŠìŒ - ì œê±°ë¨)
      function renderHeroes_DEPRECATED(heroes) {
        const heroesContainer = document.getElementById("heroes-list");
        heroesContainer.innerHTML = "";

        heroes.forEach((hero) => {
          const card = document.createElement("div");
          card.className = "hero-card selectable";

          // ì´ë¯¸ ì„ íƒëœ ì˜ì›…ì¸ì§€ í™•ì¸ (front or back)
          const isSelected = [...selectedHeroes.front, ...selectedHeroes.back].some(h => h.id === hero.id);
          if (isSelected) {
            card.classList.add("selected");
          }

          if (hero.group && hero.group.includes("(êµ¬)ì„¸ë¸ë‚˜ì´ì¸ ")) {
            card.classList.add("old-sevenknights");
          }

          // ì´ˆìƒ ì´ë¯¸ì§€ì™€ íƒ€ì… ë°°ì§€
          if (hero.portrait) {
            const imgWrapper = document.createElement("div");
            imgWrapper.className = "hero-portrait-wrap";
            imgWrapper.style.position = "relative";

            const img = document.createElement("img");
            img.src = hero.portrait;
            img.alt = hero.name || "ì´ë¯¸ì§€ ì—†ìŒ";
            const rarityClass = (() => {
              switch (hero.rarity) {
                case "ì „ì„¤+": return "legendary-plus";
                case "ì „ì„¤": return "legendary";
                case "í¬ê·€": return "rare";
                case "ê³ ê¸‰": return "uncommon";
                default: return "normal";
              }
            })();
            img.className = `hero-portrait rarity-${rarityClass}`;
            if (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1) {
              img.classList.add("has-effect");
            }
            imgWrapper.appendChild(img);

            // ë‹¤ì´ì•„ëª¬ë“œ íš¨ê³¼
            if (hero.hasEffect) {
              const gradientId = `paint0_diamond_${hero.name.replace(/\s/g, '')}_${hero.id}`;
              const starWrapper = document.createElement("div");
              starWrapper.className = "rarity-diamond-effect";
              starWrapper.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 100" fill="none">
                  <defs>
                    <linearGradient id="${gradientId}" x1="0" y1="0" x2="500" y2="500" gradientUnits="userSpaceOnUse">
                      <stop stop-color="#FFF8E1"/>
                      <stop offset="0.533654" stop-color="#FFE082"/>
                      <stop offset="1" stop-color="#FFB300"/>
                    </linearGradient>
                  </defs>
                  <path d="M99.0854 0.124826C99.6876 -0.259713 100.26 0.312411 99.8752 0.914611C74.5556 40.6083 73.1362 54.5342 90.8173 89.847C91.0858 90.3826 90.384 91.0844 89.8483 90.816L89.847 90.8174C54.5329 73.1375 40.6072 74.5546 0.914577 99.8752C0.312412 100.26 -0.259673 99.6876 0.124792 99.0854C25.4444 59.3918 26.8625 45.4671 9.18167 10.1521C8.9215 9.63314 9.57223 8.95807 10.1001 9.16059L10.1507 9.18308C45.4657 26.8639 59.3905 25.4457 99.0854 0.124826ZM65.703 34.2974C61.9959 35.3198 58.2999 36.037 54.5685 36.4171C48.0147 37.0846 41.7138 36.6839 35.4457 35.4467C36.6829 41.7148 37.0837 48.0156 36.4162 54.5693C36.0363 58.3003 35.3191 61.996 34.2969 65.7027C38.0036 64.6805 41.6993 63.9633 45.4303 63.5834C51.9843 62.9159 58.2853 63.3166 64.5537 64.5539C63.3165 58.2856 62.9157 51.9848 63.5833 45.4307C63.9634 41.6997 64.6808 38.0041 65.703 34.2974Z" fill="url(#${gradientId})"/>
                </svg>
              `;

              try {
                const stops = starWrapper.querySelectorAll(`#${gradientId} stop`);
                if (stops && stops.length >= 3) {
                  const isOldSeven = hero.group && hero.group.trim().includes("(êµ¬)ì„¸ë¸ë‚˜ì´ì¸ ");
                  if (isOldSeven) {
                    stops[0].setAttribute("stop-color", "#EEDBFF");
                    stops[1].setAttribute("stop-color", "#C49CFF");
                    stops[2].setAttribute("stop-color", "#9C6BFF");
                  } else {
                    stops[0].setAttribute("stop-color", "#FFF8E1");
                    stops[1].setAttribute("stop-color", "#FFE082");
                    stops[2].setAttribute("stop-color", "#FFB300");
                  }
                }
              } catch (e) {
                console.warn("ê·¸ë¼ë””ì–¸íŠ¸ ì ìš© ì‹¤íŒ¨:", e);
              }

              imgWrapper.appendChild(starWrapper);
            }

            if (hero.typeImage) {
              const typeBadge = document.createElement("img");
              typeBadge.src = hero.typeImage;
              typeBadge.alt = hero.type || "íƒ€ì… ë°°ì§€";
              typeBadge.className = "hero-type-badge";
              imgWrapper.appendChild(typeBadge);
            }

            card.appendChild(imgWrapper);
          }

          const name = document.createElement("div");
          name.className = "hero-name";
          name.textContent = hero.name || "ì´ë¦„ ì—†ìŒ";
          card.appendChild(name);

          if (hero.nickname) {
            const nickname = document.createElement("div");
            nickname.className = "hero-nickname";
            nickname.textContent = `${hero.nickname}`;
            card.appendChild(nickname);
          }

          // ì„ íƒ ì´ë²¤íŠ¸
          card.addEventListener("click", () => {
            toggleHeroSelection(hero, card);
          });

          heroesContainer.appendChild(card);
        });
      }

      // ì˜ì›… ì„ íƒ/í•´ì œ
      function toggleHeroSelection(hero, cardElement) {
        const allSelected = [...selectedHeroes.front, ...selectedHeroes.back];
        const existingIndex = allSelected.findIndex(h => h.id === hero.id);

        if (existingIndex > -1) {
          // ì´ë¯¸ ì„ íƒëœ ì˜ì›… - ì œê±°
          const frontIndex = selectedHeroes.front.findIndex(h => h.id === hero.id);
          if (frontIndex > -1) {
            selectedHeroes.front.splice(frontIndex, 1);
          } else {
            const backIndex = selectedHeroes.back.findIndex(h => h.id === hero.id);
            if (backIndex > -1) {
              selectedHeroes.back.splice(backIndex, 1);
            }
          }
          cardElement.classList.remove("selected");
        } else {
          // ìƒˆë¡œìš´ ì˜ì›… ì„ íƒ
          const totalSelected = selectedHeroes.front.length + selectedHeroes.back.length;
          if (totalSelected >= MAX_DECK_SIZE) {
            alert(`ìµœëŒ€ ${MAX_DECK_SIZE}ëª…ê¹Œì§€ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
            return;
          }

          // í˜„ì¬ ì§„í˜•ì— ë”°ë¼ ì ì ˆí•œ ë¼ì¸ì— ì¶”ê°€
          const formation = formations[currentFormation];
          if (selectedHeroes.front.length < formation.front) {
            selectedHeroes.front.push(hero);
          } else if (selectedHeroes.back.length < formation.back) {
            selectedHeroes.back.push(hero);
          } else {
            // ë‘˜ ë‹¤ ê°€ë“ ì°¬ ê²½ìš° (ì´ë¡ ìƒ ë„ë‹¬ ë¶ˆê°€ëŠ¥)
            alert(`ë±ì´ ê°€ë“ ì°¼ìŠµë‹ˆë‹¤.`);
            return;
          }
          cardElement.classList.add("selected");
        }

        updateDeckDisplay();
        updateSelectedCount();
      }

      // ë± ë””ìŠ¤í”Œë ˆì´ ì—…ë°ì´íŠ¸
      function updateDeckDisplay() {
        // ì•ì¤„ ìŠ¬ë¡¯ ì—…ë°ì´íŠ¸
        const frontSlots = document.querySelectorAll('.front-slot');
        frontSlots.forEach((slot, index) => {
          const hero = selectedHeroes.front[index];

          if (hero) {
            slot.innerHTML = `
              <div class="slot-indicator">F</div>
              <div class="slot-hero">
                <img src="${hero.portrait}" alt="${hero.name}" class="slot-hero-portrait rarity-${getRarityClass(hero.rarity)}" />
                <div class="slot-hero-name">${hero.name}</div>
                <button class="slot-remove" data-line="front" data-index="${index}">Ã—</button>
              </div>
            `;

            const removeBtn = slot.querySelector('.slot-remove');
            removeBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              removeHeroFromDeck('front', index);
            });
          } else {
            slot.innerHTML = `
              <div class="slot-indicator">F</div>
              <div class="slot-placeholder">+</div>
            `;
          }

          // ìŠ¬ë¡¯ í´ë¦­ ì´ë²¤íŠ¸ ì¬ë¶€ì°©
          slot.replaceWith(slot.cloneNode(true));
          const newSlot = document.querySelectorAll('.front-slot')[index];
          newSlot.addEventListener('click', (e) => {
            // ì œê±° ë²„íŠ¼ í´ë¦­ì´ ì•„ë‹ ê²½ìš°ì—ë§Œ ëª¨ë‹¬ ì—´ê¸°
            if (!e.target.closest('.slot-remove')) {
              openHeroSelectModal('front', index);
            }
          });

          if (hero) {
            const removeBtn = newSlot.querySelector('.slot-remove');
            removeBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              removeHeroFromDeck('front', index);
            });
          }
        });

        // ë’·ì¤„ ìŠ¬ë¡¯ ì—…ë°ì´íŠ¸
        const backSlots = document.querySelectorAll('.back-slot');
        backSlots.forEach((slot, index) => {
          const hero = selectedHeroes.back[index];

          if (hero) {
            slot.innerHTML = `
              <div class="slot-indicator">B</div>
              <div class="slot-hero">
                <img src="${hero.portrait}" alt="${hero.name}" class="slot-hero-portrait rarity-${getRarityClass(hero.rarity)}" />
                <div class="slot-hero-name">${hero.name}</div>
                <button class="slot-remove" data-line="back" data-index="${index}">Ã—</button>
              </div>
            `;

            const removeBtn = slot.querySelector('.slot-remove');
            removeBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              removeHeroFromDeck('back', index);
            });
          } else {
            slot.innerHTML = `
              <div class="slot-indicator">B</div>
              <div class="slot-placeholder">+</div>
            `;
          }

          // ìŠ¬ë¡¯ í´ë¦­ ì´ë²¤íŠ¸ ì¬ë¶€ì°©
          slot.replaceWith(slot.cloneNode(true));
          const newSlot = document.querySelectorAll('.back-slot')[index];
          newSlot.addEventListener('click', (e) => {
            // ì œê±° ë²„íŠ¼ í´ë¦­ì´ ì•„ë‹ ê²½ìš°ì—ë§Œ ëª¨ë‹¬ ì—´ê¸°
            if (!e.target.closest('.slot-remove')) {
              openHeroSelectModal('back', index);
            }
          });

          if (hero) {
            const removeBtn = newSlot.querySelector('.slot-remove');
            removeBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              removeHeroFromDeck('back', index);
            });
          }
        });
      }

      // ë±ì—ì„œ ì˜ì›… ì œê±°
      function removeHeroFromDeck(line, index) {
        if (line === 'front') {
          selectedHeroes.front[index] = null;
        } else if (line === 'back') {
          selectedHeroes.back[index] = null;
        }
        updateDeckDisplay();
      }

      // ë“±ê¸‰ í´ë˜ìŠ¤ ë°˜í™˜
      function getRarityClass(rarity) {
        switch (rarity) {
          case "ì „ì„¤+": return "legendary-plus";
          case "ì „ì„¤": return "legendary";
          case "í¬ê·€": return "rare";
          case "ê³ ê¸‰": return "uncommon";
          default: return "normal";
        }
      }

      // ë± ì´ˆê¸°í™”
      document.getElementById('clear-deck').addEventListener('click', () => {
        const formation = formations[currentFormation];
        const hasHeroes = selectedHeroes.front.some(h => h) || selectedHeroes.back.some(h => h);

        if (!hasHeroes) return;

        if (confirm('ë±ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          selectedHeroes.front = new Array(formation.front).fill(null);
          selectedHeroes.back = new Array(formation.back).fill(null);
          updateDeckDisplay();
        }
      });

      // ë± ê³µìœ 
      document.getElementById('share-deck').addEventListener('click', () => {
        const allHeroes = [...selectedHeroes.front, ...selectedHeroes.back].filter(h => h);

        if (allHeroes.length === 0) {
          alert('ê³µìœ í•  ì˜ì›…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
          return;
        }

        const allHeroNames = allHeroes.map(h => encodeURIComponent(h.name)).join(',');
        const shareUrl = `${window.location.origin}/deck.html?deck=${allHeroNames}&formation=${currentFormation}`;

        document.getElementById('share-url').value = shareUrl;
        document.getElementById('share-modal').style.display = 'flex';
      });

      // ëª¨ë‹¬ ë‹«ê¸°
      document.getElementById('close-modal').addEventListener('click', () => {
        document.getElementById('share-modal').style.display = 'none';
        document.getElementById('copy-success').style.display = 'none';
      });

      // URL ë³µì‚¬
      document.getElementById('copy-url').addEventListener('click', () => {
        const urlInput = document.getElementById('share-url');
        urlInput.select();
        document.execCommand('copy');

        const successMsg = document.getElementById('copy-success');
        successMsg.style.display = 'block';
        setTimeout(() => {
          successMsg.style.display = 'none';
        }, 3000);
      });

      // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ì‹œ ë‹«ê¸°
      document.getElementById('share-modal').addEventListener('click', (e) => {
        if (e.target.id === 'share-modal') {
          document.getElementById('share-modal').style.display = 'none';
          document.getElementById('copy-success').style.display = 'none';
        }
      });

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      document.addEventListener("DOMContentLoaded", () => {
        fetchHeroes();
      });
    </script>

    <script>
      // í…Œë§ˆ í† ê¸€ ê¸°ëŠ¥
      const themeToggle = document.getElementById('theme-toggle');
      const themeIcon = document.getElementById('theme-icon');
      const themeText = document.getElementById('theme-text');
      const htmlElement = document.documentElement;

      // ì €ì¥ëœ í…Œë§ˆ ë˜ëŠ” ì‹œìŠ¤í…œ ê¸°ë³¸ê°’ ê°€ì ¸ì˜¤ê¸°
      function getInitialTheme() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
          return savedTheme;
        }
        // ì‹œìŠ¤í…œ ë‹¤í¬ ëª¨ë“œ ì„¤ì • í™•ì¸
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        return prefersDark ? 'dark' : 'light';
      }

      // í…Œë§ˆ ì ìš©
      function applyTheme(theme) {
        if (theme === 'light') {
          htmlElement.setAttribute('data-theme', 'light');
          themeIcon.className = 'ph-bold ph-moon';
          themeText.textContent = 'ë‹¤í¬ ëª¨ë“œ';
        } else {
          htmlElement.removeAttribute('data-theme');
          themeIcon.className = 'ph-bold ph-sun';
          themeText.textContent = 'ë¼ì´íŠ¸ ëª¨ë“œ';
        }
        localStorage.setItem('theme', theme);
      }

      // í…Œë§ˆ ì „í™˜
      function toggleTheme() {
        const currentTheme = htmlElement.getAttribute('data-theme') === 'light' ? 'light' : 'dark';
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        applyTheme(newTheme);
      }

      // ì´ˆê¸° í…Œë§ˆ ì ìš©
      applyTheme(getInitialTheme());

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      themeToggle.addEventListener('click', toggleTheme);

      // ì‹œìŠ¤í…œ í…Œë§ˆ ë³€ê²½ ê°ì§€ (ì„ íƒì‚¬í•­)
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (!localStorage.getItem('theme')) {
          applyTheme(e.matches ? 'dark' : 'light');
        }
      });
    </script>

    <!-- Mobile Menu Script -->
    <script src="/js/mobile-menu.js"></script>
  </body>
</html>
