<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="dynamic-title">ì˜ì›… ìƒì„¸ - ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ë„ê°</title>
  <!-- SEO Meta Tags for Hero Detail Page -->
  <meta id="meta-description" name="description" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›… ìƒì„¸ í˜ì´ì§€" />
  <meta id="meta-keywords" name="keywords" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤, ì˜ì›…, ìƒì„¸, ë„ê°, Seven Knights, Hero, Detail" />
  <meta name="author" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ë„ê°" />
  <!-- Open Graph Meta Tags -->
  <meta property="og:site_name" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ë„ê°" />
  <meta id="og-title" property="og:title" content="ì˜ì›… ìƒì„¸ - ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ë„ê°" />
  <meta id="og-description" property="og:description" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›…ì˜ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”." />
  <meta id="og-image" property="og:image" content="/default-hero-og-image.png" />
  <meta id="og-url" property="og:url" content="https://sk-dogam.app/hero.html" />
  <meta property="og:type" content="article" />
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta id="twitter-title" name="twitter:title" content="ì˜ì›… ìƒì„¸ - ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ë„ê°" />
  <meta id="twitter-description" name="twitter:description" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›…ì˜ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”." />
  <meta id="twitter-image" name="twitter:image" content="/default-hero-og-image.png" />
  <!-- Canonical Link -->
  <link id="canonical-link" rel="canonical" href="https://sk-dogam.app/hero.html" />
  <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="googlebot" content="index, follow">
  <meta name="naverbot" content="index, follow">
  <meta name="subject" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›… ìƒì„¸ ì •ë³´, ìŠ¤í‚¬, ëŠ¥ë ¥ì¹˜, ì†Œì†">
  <meta name="rating" content="general">
  <meta name="distribution" content="global">
  <meta name="theme-color" content="#181818">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "VideoGameCharacter",
  "name": "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›…",
  "url": "https://sk-dogam.app/hero.html",
  "description": "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›…ì˜ ìŠ¤íƒ¯, ìŠ¤í‚¬, ì†Œì† ë° í¬ê·€ë„ ìƒì„¸ ì •ë³´ í˜ì´ì§€ì…ë‹ˆë‹¤.",
  "inLanguage": "ko",
  "isPartOf": {
    "@type": "VideoGame",
    "name": "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ (Seven Knights Re:birth)"
  }
}
</script>
  <link rel="stylesheet" href="./style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2"></script>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DMD8LXSEQ5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DMD8LXSEQ5', {
    'page_title': 'Hero Detail',
    'page_path': window.location.pathname + window.location.search
  });
</script>
</head>
<body>
  <header class="hero-header">
    <button class="back-button" onclick="window.history.back()"><i class="ph-bold ph-caret-left"></i> ëª©ë¡ìœ¼ë¡œ</button>
  </header>

  <div class="hero-detail-page">
    <main class="hero-detail-container">
    <h1>ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›… ìƒì„¸ ì •ë³´</h1>
    <p class="subtitle">ì˜ì›…ì˜ ìŠ¤íƒ¯, ìŠ¤í‚¬, í¬ê·€ë„ ë° ì†Œì†ì„ ìì„¸íˆ í™•ì¸í•˜ì„¸ìš”.</p>
    <section class="hero-top">
      <div class="hero-portrait-wrap">
        <img id="hero-portrait" class="hero-portrait" alt="ì˜ì›… ì´ˆìƒí™”" />
        
      </div>
      <div class="hero-basic-info">
        <h1 id="hero-name" class="hero-name"></h1>
        <p id="hero-nickname" class="hero-nickname"></p>
        <p id="hero-group" class="hero-group"></p>
        <div class="hero-meta">
          <span id="hero-type" class="hero-type"></span>
          <span id="hero-rarity" class="hero-rarity"></span>
        </div>
      </div>
    </section>

    <section class="hero-stats">
      <h2>ìŠ¤íƒ¯</h2>
      <table class="stats-table">
        <tr><td>ê³µê²©ë ¥</td><td id="atk"></td></tr>
        <tr><td>ë°©ì–´ë ¥</td><td id="def"></td></tr>
        <tr><td>ìƒëª…ë ¥</td><td id="hp"></td></tr>
        <tr><td>ì†ê³µ</td><td id="spd"></td></tr>
        <tr><td>ì¹˜ëª…íƒ€ í™•ë¥ (%)</td><td id="crit_rate"></td></tr>
        <tr><td>ì¹˜ëª…íƒ€ í”¼í•´(%)</td><td id="crit_dmg"></td></tr>
        <tr><td>ì•½ì  ê³µê²© í™•ë¥ (%)</td><td id="weak_rate"></td></tr>
        <tr><td>ë§‰ê¸° í™•ë¥ (%)</td><td id="block_rate"></td></tr>
        <tr><td>ë°›ëŠ” í”¼í•´ ê°ì†Œ(%)</td><td id="dmg_reduce"></td></tr>
        <tr><td>íš¨ê³¼ ì ì¤‘(%)</td><td id="eff_hit"></td></tr>
        <tr><td>íš¨ê³¼ ì €í•­(%)</td><td id="eff_res"></td></tr>
      </table>
    </section>

    <section class="hero-skills">
      <h2>ìŠ¤í‚¬</h2>
      <div class="skill attack-skill">
        <h3>ê¸°ë³¸ ê³µê²©</h3>
        <img id="attack-image" alt="ê³µê²© ì´ë¯¸ì§€" />
        <p><strong id="attack-name" class="skill-name"></strong> <span id="attack-cooltime" class="skill-cooltime"></span></p>
        <p id="attack-desc" class="skill-desc"></p>
      </div>
      <div class="skill active-skill-1">
        <h3>ì•¡í‹°ë¸Œ ìŠ¤í‚¬ 1</h3>
        <img id="active-1-image" alt="ì•¡í‹°ë¸Œ ìŠ¤í‚¬ 1 ì´ë¯¸ì§€" />
        <p><strong id="active-1-name" class="skill-name"></strong> <span id="active-1-cooltime" class="skill-cooltime"></span></p>
        <p id="active-1-desc" class="skill-desc"></p>
      </div>
      <div class="skill active-skill-2">
        <h3>ì•¡í‹°ë¸Œ ìŠ¤í‚¬ 2</h3>
        <img id="active-2-image" alt="ì•¡í‹°ë¸Œ ìŠ¤í‚¬ 2 ì´ë¯¸ì§€" />
        <p><strong id="active-2-name" class="skill-name"></strong> <span id="active-2-cooltime" class="skill-cooltime"></span></p>
        <p id="active-2-desc" class="skill-desc"></p>
      </div>
      <div class="skill passive-skill">
        <h3>íŒ¨ì‹œë¸Œ</h3>
        <img id="passive-image" alt="íŒ¨ì‹œë¸Œ ì´ë¯¸ì§€" />
        <p><strong id="passive-name" class="skill-name"></strong> <span id="passive-cooltime" class="skill-cooltime"></span></p>
        <p id="passive-desc" class="skill-desc"></p>
      </div>
    </section>

    <section class="hero-description">
      <h2>ì„¤ëª…</h2>
      <p id="hero-description"></p>
    </section>
    </main>

    <section class="hero-comments">
      <h2>ì˜ê²¬ ë‚¨ê¸°ê¸°</h2>
      <form id="comment-form">
        <input type="text" id="nickname" name="nickname" placeholder="ë‹‰ë„¤ì„" required />
        <textarea id="comment-content" name="content" placeholder="ì˜ê²¬ì„ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
        <button type="submit">ë“±ë¡</button>
      </form>
      <ul id="comment-list" class="comment-list"></ul>
    </section>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    window.heroId = params.get("id");
    const heroId = window.heroId;

    if (!heroId) {
      document.querySelector("main").innerHTML = "<p>ìœ íš¨í•˜ì§€ ì•Šì€ ì˜ì›… IDì…ë‹ˆë‹¤.</p>";
    } else {
      fetch(`/api/hero/${heroId}`)
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(hero => {
          if (!hero || !hero.name) {
            document.querySelector("main").innerHTML = "<p>ì˜ì›… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
          }

          // Update SEO meta tags dynamically
          const heroTitle = `${hero.name} (${hero.rarity} / ${hero.type}) - ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ë„ê°`;
          document.title = heroTitle;
          const titleEl = document.getElementById("dynamic-title");
          if (titleEl) titleEl.textContent = heroTitle;

          // ë” í’ë¶€í•œ ì„¤ëª… ë¬¸ì¥
          const desc = `${hero.name} (${hero.rarity} / ${hero.type}) â€” ${hero.group || "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤"} ì†Œì† ì˜ì›…ì˜ ìŠ¤íƒ¯, ìŠ¤í‚¬, ëŠ¥ë ¥ì¹˜ë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.`;
          const ogDesc = hero.description || desc;
          const url = `${location.origin}${location.pathname}?id=${encodeURIComponent(heroId)}`;

          // Description
          const descMeta = document.getElementById("meta-description");
          if (descMeta) descMeta.setAttribute("content", desc);

          // Keywords (ì˜ì›… ì´ë¦„, ì†Œì†, íƒ€ì…, í¬ê·€ë„ ì¶”ê°€)
          const keywordsMeta = document.getElementById("meta-keywords");
          if (keywordsMeta) {
            const keywords = [
              "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤", "ì˜ì›…", "ìƒì„¸", "ë„ê°", "Seven Knights", "Hero", "Detail",
              hero.name, hero.group, hero.type, hero.rarity
            ].filter(Boolean).join(", ");
            keywordsMeta.setAttribute("content", keywords);
          }

          // Open Graph
          const ogTitle = document.getElementById("og-title");
          if (ogTitle) ogTitle.setAttribute("content", heroTitle);
          const ogDescEl = document.getElementById("og-description");
          if (ogDescEl) ogDescEl.setAttribute("content", ogDesc);
          const ogImage = document.getElementById("og-image");
          if (ogImage) ogImage.setAttribute("content", hero.portrait || "/default-hero-og-image.png");
          const ogUrl = document.getElementById("og-url");
          if (ogUrl) ogUrl.setAttribute("content", url);

          // Twitter Card
          const twTitle = document.getElementById("twitter-title");
          if (twTitle) twTitle.setAttribute("content", heroTitle);
          const twDesc = document.getElementById("twitter-description");
          if (twDesc) twDesc.setAttribute("content", ogDesc);
          const twImage = document.getElementById("twitter-image");
          if (twImage) twImage.setAttribute("content", hero.portrait || "/default-hero-og-image.png");

          // Canonical
          const canonical = document.getElementById("canonical-link");
          if (canonical) canonical.setAttribute("href", url);

          // âœ… êµ¬ì¡°í™” ë°ì´í„°(JSON-LD) ë™ì  ìƒì„±
          const heroSchema = {
            "@context": "https://schema.org",
            "@type": "VideoGameCharacter",
            "name": hero.name,
            "alternateName": hero.nickname || undefined,
            "description": desc,
            "image": hero.portrait || "/default-hero-og-image.png",
            "url": url,
            "inLanguage": "ko",
            "rarity": hero.rarity,
            "characterAttribute": hero.type,
            "memberOf": hero.group || "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤",
            "isPartOf": {
              "@type": "VideoGame",
              "name": "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ (Seven Knights Re:birth)"
            }
          };
          const jsonLdEl = document.querySelector('script[type="application/ld+json"]');
          if (jsonLdEl) {
            jsonLdEl.textContent = JSON.stringify(heroSchema, null, 2);
          }

          // ê¸°ë³¸ ì •ë³´
          document.getElementById("hero-portrait").src = hero.portrait || "";
          // Remove old diamond/star SVG code. Insert index.html's hero card diamond logic here.
          // Add diamond/star effect to hero portrait area if hero.hasEffect
          if (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1) {
            const portraitWrap = document.querySelector(".hero-portrait-wrap");
            if (portraitWrap && !portraitWrap.querySelector('.rarity-diamond-effect')) {
              // Unique gradient id to avoid collision
              const gradId = `diamond-gradient-${hero.id}`;
              // Determine if old (êµ¬)ì„¸ë¸ë‚˜ì´ì¸ 
              const isOldSevenKnights = hero.group && hero.group.includes("(êµ¬)ì„¸ë¸ë‚˜ì´ì¸ ");
              const diamond = document.createElement("div");
              diamond.className = "rarity-diamond-effect";
              diamond.style.position = "absolute";
              diamond.style.top = "8px";
              diamond.style.right = "8px";
              diamond.style.zIndex = "3";
              diamond.innerHTML = `
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <defs>
                    <linearGradient id="${gradId}" x1="0" y1="0" x2="40" y2="40" gradientUnits="userSpaceOnUse">
                      ${
                        isOldSevenKnights
                          ? `
                            <stop offset="0%" stop-color="#C77DFF"/>
                            <stop offset="100%" stop-color="#7B2FF7"/>
                          `
                          : `
                            <stop offset="0%" stop-color="#FFF8E1"/>
                            <stop offset="60%" stop-color="#FFE082"/>
                            <stop offset="100%" stop-color="#FFB300"/>
                          `
                      }
                    </linearGradient>
                  </defs>
                  <polygon points="20,2 38,20 20,38 2,20" fill="url(#${gradId})" fill-opacity="0.85"/>
                  <polygon points="20,8 32,20 20,32 8,20" fill="white" fill-opacity="0.22"/>
                </svg>
              `;
              portraitWrap.appendChild(diamond);
            }
          }
          // í¬ê·€ë„ ìŠ¤íŒŒí¬ íš¨ê³¼ SVGì˜ ê·¸ë¼ë””ì–¸íŠ¸ ë™ì  ì „í™˜
          (function handleSparkGradient() {
            const svg = document.getElementById("rarity-spark-star-svg");
            const path = document.getElementById("rarity-spark-star-path");
            if (!svg || !path) return;
            if (hero.group && hero.group.includes("(êµ¬)ì„¸ë¸ë‚˜ì´ì¸ ")) {
              path.setAttribute("fill", "url(#sparkGradientOld)");
            } else {
              path.setAttribute("fill", "url(#sparkGradient)");
            }
          })();
          // í¬ê·€ë„ë³„ ë°°ê²½ìƒ‰ í´ë˜ìŠ¤ ì ìš©
          const portraitEl = document.getElementById("hero-portrait");
          if (portraitEl) {
            const rarityClass = (() => {
              switch (hero.rarity) {
                case "ì „ì„¤+": return "legendary-plus";
                case "ì „ì„¤": return "legendary";
                case "í¬ê·€": return "rare";
                case "ê³ ê¸‰": return "uncommon";
                default: return "normal";
              }
            })();
            portraitEl.classList.add(`rarity-${rarityClass}`);
          }
          // hasEffectê°€ trueë©´ ì´ˆìƒí™”ì— ë¹›ë‚˜ëŠ” í…Œë‘ë¦¬ í´ë˜ìŠ¤ ë¶€ì—¬
          if (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1) {
            const portraitEl = document.getElementById("hero-portrait");
            if (portraitEl) {
              portraitEl.classList.add("has-effect");
            }
          }
          document.getElementById("hero-name").textContent = hero.name || "";
          document.getElementById("hero-nickname").textContent = hero.nickname || "";
          document.getElementById("hero-group").textContent = hero.group || "";
          document.getElementById("hero-type").textContent = hero.type || "";
          document.getElementById("hero-rarity").textContent = hero.rarity || "";

          // ìŠ¤íƒ¯
          const statFields = ["atk","def","hp","spd","crit_rate","crit_dmg","weak_rate","block_rate","dmg_reduce","eff_hit","eff_res"];
          statFields.forEach(field => {
            document.getElementById(field).textContent = hero[field] || "-";
          });

          // ìŠ¤í‚¬ ì¶œë ¥ í•¨ìˆ˜
          const renderSkill = (prefix, skill) => {
            document.getElementById(`${prefix}-image`).src = skill?.image || "";
            document.getElementById(`${prefix}-name`).textContent = skill?.name || "";
            document.getElementById(`${prefix}-cooltime`).textContent = skill?.cooltime ? `ì¿¨íƒ€ì„: ${skill.cooltime}` : "";
            document.getElementById(`${prefix}-desc`).textContent = skill?.desc || "";
          };

          renderSkill("attack", hero.attack);
          renderSkill("active-1", hero.active_1);
          renderSkill("active-2", hero.active_2);
          renderSkill("passive", hero.passive);

          document.getElementById("hero-description").textContent = hero.description || "";
        })
        .catch(err => {
          console.error("Hero fetch error:", err);
          document.querySelector("main").innerHTML = "<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>";
        });
    }
</script>

  <script>
    const commentForm = document.getElementById("comment-form");
    const commentList = document.getElementById("comment-list");

    // ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadComments() {
      try {
        const res = await fetch(`/api/comments/${heroId}`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        commentList.innerHTML = "";
        (data.comments || []).forEach(comment => {
          const li = document.createElement("li");
          li.innerHTML = `<strong>${comment.nickname}</strong><p>${comment.content}</p><span>${comment.timestamp || ""}</span>`;
          commentList.appendChild(li);
        });
      } catch (err) {
        console.error("ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", err);
      }
    }

    // ëŒ“ê¸€ ë“±ë¡
commentForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const nickname = document.getElementById("nickname").value.trim();
  const content = document.getElementById("comment-content").value.trim();
  if (!nickname || !content) return alert("ë‹‰ë„¤ì„ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

  try {
    // âœ… [ì¶”ê°€ëœ ë¶€ë¶„] ì‹¤ì œë¡œ ì „ì†¡ë˜ëŠ” ë°ì´í„°ë¥¼ ì½˜ì†”ì— ì¶œë ¥
    console.log("ğŸ“© ì „ì†¡ ë°ì´í„°:", { heroId, nickname, content });

    const res = await fetch(`/api/comments/${heroId}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ heroId, nickname, content }),
    });

    // âœ… [ì¶”ê°€ëœ ë¶€ë¶„] ì„œë²„ ì‘ë‹µ ìƒíƒœ ì½”ë“œ í™•ì¸
    console.log("ğŸ“© ì„œë²„ ì‘ë‹µ ìƒíƒœ:", res.status);

    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    document.getElementById("comment-content").value = "";
    await loadComments();
  } catch (err) {
    console.error("âŒ ëŒ“ê¸€ ë“±ë¡ ì˜¤ë¥˜:", err);
    alert("ëŒ“ê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
  }
});

    // ì´ˆê¸° ë¡œë“œ
    loadComments();
  </script>
</body>
</html>