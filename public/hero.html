<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title id="dynamic-title">ì˜ì›… ìƒì„¸ - ì„¸ë‚˜DB</title>
  <!-- SEO Meta Tags for Hero Detail Page -->
  <meta id="meta-description" name="description" content="ì„¸ë‚˜DB - ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›… ìƒì„¸ í˜ì´ì§€" />
  <meta id="meta-keywords" name="keywords" content="ì„¸ë‚˜DB, ì„¸ë‚˜db, ì„¸ë‚˜ ë¦¬ë²„ìŠ¤, ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤, ì˜ì›…, ìƒì„¸, ë„ê°, Seven Knights, Hero, Detail" />
  <meta name="author" content="ì„¸ë‚˜DB" />
  <!-- Open Graph Meta Tags -->
  <meta property="og:site_name" content="ì„¸ë‚˜DB" />
  <meta id="og-title" property="og:title" content="ì˜ì›… ìƒì„¸ - ì„¸ë‚˜DB" />
  <meta id="og-description" property="og:description" content="ì„¸ë‚˜DB - ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›…ì˜ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”." />
  <meta id="og-image" property="og:image" content="/default-hero-og-image.png" />
  <meta id="og-url" property="og:url" content="https://senadb.games/hero.html" />
  <meta property="og:type" content="article" />
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta id="twitter-title" name="twitter:title" content="ì˜ì›… ìƒì„¸ - ì„¸ë‚˜DB" />
  <meta id="twitter-description" name="twitter:description" content="ì„¸ë‚˜DB - ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›…ì˜ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”." />
  <meta id="twitter-image" name="twitter:image" content="/default-hero-og-image.png" />
  <!-- Canonical Link -->
  <link id="canonical-link" rel="canonical" href="https://senadb.games/hero.html" />
  <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="googlebot" content="index, follow">
  <meta name="naverbot" content="index, follow">
  <meta name="subject" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›… ìƒì„¸ ì •ë³´, ìŠ¤í‚¬, ëŠ¥ë ¥ì¹˜, ì†Œì†">
  <meta name="rating" content="general">
  <meta name="distribution" content="global">
  <meta name="theme-color" content="#181818">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7293515082092840"
     crossorigin="anonymous"></script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "VideoGameCharacter",
  "name": "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›…",
  "url": "https://senadb.games/hero.html",
  "description": "ì„¸ë‚˜DB - ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›…ì˜ ìŠ¤íƒ¯, ìŠ¤í‚¬, ì†Œì† ë° í¬ê·€ë„ ìƒì„¸ ì •ë³´ í˜ì´ì§€ì…ë‹ˆë‹¤.",
  "inLanguage": "ko",
  "isPartOf": {
    "@type": "VideoGame",
    "name": "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ (Seven Knights Re:birth)"
  }
}
</script>
  <link rel="stylesheet" href="./style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2"></script>
  <!-- Developer Mode Handler -->
  <script src="/js/devmode.js"></script>
  <!-- Google tag (gtag.js) - Only on production -->
  <script>
    // Only load analytics on production domain and not in developer mode
    // To enable developer mode (exclude your traffic):
    //   URL: https://senadb.games/?devMode=true (recommended for mobile)
    //   Console: localStorage.setItem('devMode', 'true')
    // To disable developer mode:
    //   URL: https://senadb.games/?devMode=false
    //   Console: localStorage.removeItem('devMode')
    var isProduction = window.location.hostname === 'senadb.games';
    var isDeveloperMode = localStorage.getItem('devMode') === 'true';

    if (isProduction && !isDeveloperMode) {
      // Load gtag.js
      var gtagScript = document.createElement('script');
      gtagScript.async = true;
      gtagScript.src = 'https://www.googletagmanager.com/gtag/js?id=G-DMD8LXSEQ5';
      document.head.appendChild(gtagScript);

      // Initialize GA with hero-specific tracking
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      // Dynamically extract hero name for analytics
      const analyticsParams = new URLSearchParams(window.location.search);
      const heroNameForAnalytics = analyticsParams.get("name") || "unknown";
      gtag('config', 'G-DMD8LXSEQ5', {
        'page_title': `Hero Detail - ${heroNameForAnalytics}`,
        'page_path': `/hero/${encodeURIComponent(heroNameForAnalytics)}`
      });
    } else if (isDeveloperMode) {
      console.log('Developer mode enabled - Analytics disabled');
    }
  </script>
  <!-- Eruda: Mobile Developer Tools -->
  <script>
    // Load Eruda in developer mode for mobile debugging
    var isDeveloperMode = localStorage.getItem('devMode') === 'true';
    if (isDeveloperMode) {
      (function() {
        var script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/eruda';
        script.onload = function() {
          eruda.init();
          console.log('Eruda mobile debugger initialized');
        };
        document.head.appendChild(script);
      })();
    }
  </script>
</head>
<body>
  <script>
    // ì „ì—­ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ heroId
    const globalParams = new URLSearchParams(window.location.search);
    window.heroId = globalParams.get("name") ? decodeURIComponent(globalParams.get("name")) : null;
  </script>
  <div class="app-container">
    <!-- HeaderëŠ” /js/header.jsì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->

    <!-- Desktop Navigation Sidebar -->
    <aside class="desktop-nav">
      <nav>
        <a href="/index.html" class="nav-link">
          <i class="ph-bold ph-users-three"></i>
          <span>ì˜ì›… ë„ê°</span>
        </a>
        <a href="/deck.html" class="nav-link">
          <i class="ph-bold ph-sword"></i>
          <span>ê²°íˆ¬ì¥ ë±</span>
        </a>
        <a href="/tier-list.html" class="nav-link">
          <i class="ph-bold ph-ranking"></i>
          <span>í‹°ì–´í‘œ</span>
        </a>
        <a href="/beginner-guide.html" class="nav-link">
          <i class="ph-bold ph-book-open"></i>
          <span>ì´ˆë³´ì ê°€ì´ë“œ</span>
        </a>
        <a href="/faq.html" class="nav-link">
          <i class="ph-bold ph-question"></i>
          <span>FAQ</span>
        </a>
      </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="main-container">
      <div class="hero-detail-page">
    <div class="hero-detail-container">
      <div id="hero-skeleton" class="skeleton-container">
        <div class="skeleton hero-portrait-skeleton"></div>
        <div class="skeleton hero-name-skeleton"></div>
        <div class="skeleton hero-meta-skeleton"></div>
        <div class="skeleton skill-skeleton"></div>
        <div class="skeleton skill-skeleton"></div>
        <div class="skeleton skill-skeleton"></div>
      </div>
    <!-- Page Header (Hidden for visual, visible for SEO & Screen Readers) -->
    <div class="page-header sr-only">
      <h1 id="hero-guide-heading">ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›… ìƒì„¸ ì •ë³´</h1>
      <p class="subtitle">ì˜ì›…ì˜ ìŠ¤íƒ¯, ìŠ¤í‚¬, í¬ê·€ë„ ë° ì†Œì†ì„ ìì„¸íˆ í™•ì¸í•˜ì„¸ìš”.</p>
    </div>

    <!-- Breadcrumb -->
    <nav class="breadcrumb">
      <a href="/">í™ˆ</a>
      <i class="ph-bold ph-caret-right"></i>
      <a href="/index.html">ì˜ì›… ë„ê°</a>
      <i class="ph-bold ph-caret-right"></i>
      <span id="breadcrumb-hero-name">ì˜ì›… ìƒì„¸</span>
    </nav>

    <!-- ëª©ë¡ìœ¼ë¡œ ë²„íŠ¼ -->
    <div class="hero-nav-buttons">
      <button class="back-button" onclick="window.location.href='/index.html'"><i class="ph-bold ph-caret-left"></i> ëª©ë¡ìœ¼ë¡œ</button>
    </div>

    <!-- ì˜ì›… ìºëŸ¬ì…€ ë„¤ë¹„ê²Œì´ì…˜ -->
    <section class="hero-carousel-section">
      <button class="carousel-nav-btn carousel-nav-prev" id="carousel-prev" aria-label="ì´ì „ ì˜ì›…">
        <i class="ph-bold ph-caret-left"></i>
      </button>
      <div class="hero-carousel" id="hero-carousel">
        <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
      </div>
      <button class="carousel-nav-btn carousel-nav-next" id="carousel-next" aria-label="ë‹¤ìŒ ì˜ì›…">
        <i class="ph-bold ph-caret-right"></i>
      </button>
    </section>

    <section class="hero-top">
      <div class="hero-center-content">
        <div class="hero-portrait-wrap">
          <img id="hero-portrait" class="hero-portrait" alt="ì˜ì›… ì´ˆìƒí™”" loading="lazy" />
        </div>

        <div class="hero-basic-info">
          <p id="hero-nickname" class="hero-nickname"></p>
          <h2 id="hero-name" class="hero-name"></h2>
          <div class="hero-meta">
            <span id="hero-group" class="hero-group"></span>
            <span id="hero-type" class="hero-type"></span>
            <span id="hero-rarity" class="hero-rarity"></span>
          </div>

          <!-- Average Rating Display -->
          <div class="hero-rating-display" id="hero-rating-display" style="display: none;">
            <div class="rating-stars">
              <i class="ph-fill ph-star"></i>
              <span class="rating-value" id="average-rating">0.0</span>
            </div>
            <span class="rating-count">(<span id="comment-count">0</span>)</span>
          </div>
        </div>
      </div>
    </section>

    <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="hero-tabs">
      <button class="tab-btn active" data-tab="stats">ìŠ¤íƒ¯</button>
      <button class="tab-btn" data-tab="skills">ìŠ¤í‚¬</button>
      <button class="tab-btn" data-tab="guide">ê°€ì´ë“œ</button>
      <button class="tab-btn" data-tab="comments">ì˜ê²¬</button>
      <button class="tab-btn" data-tab="history">ì—…ë°ì´íŠ¸</button>
    </div>

    <!-- íƒ­ ì»¨í…ì¸  -->
    <div class="tab-content active" id="tab-stats">
      <section class="hero-stats-container">
        <!-- ì¢Œì¸¡: ê¸°ë³¸ ìŠ¤íƒ¯ -->
        <div class="stats-left">
          <p class="stats-info">30ë ˆë²¨ 5ê°•í™” 0ì´ˆì›” ê¸°ì¤€ì…ë‹ˆë‹¤</p>
          <table class="stats-table">
            <tr><td><img src="/images/stat-atk.png" alt="ê³µê²©ë ¥" class="stat-icon"/>ê³µê²©ë ¥</td><td id="atk"></td></tr>
            <tr><td><img src="/images/stat-def.png" alt="ë°©ì–´ë ¥" class="stat-icon"/>ë°©ì–´ë ¥</td><td id="def"></td></tr>
            <tr><td><img src="/images/stat-hp.png" alt="ìƒëª…ë ¥" class="stat-icon"/>ìƒëª…ë ¥</td><td id="hp"></td></tr>
            <tr><td><img src="/images/stat-spd.png" alt="ì†ê³µ" class="stat-icon"/>ì†ê³µ</td><td id="spd"></td></tr>
            <tr><td><img src="/images/stat-crit_rate.png" alt="ì¹˜í™•" class="stat-icon"/>ì¹˜ëª…íƒ€ í™•ë¥ (%)</td><td id="crit_rate"></td></tr>
            <tr><td><img src="/images/stat-crit_dmg.png" alt="ì¹˜í”¼" class="stat-icon"/>ì¹˜ëª…íƒ€ í”¼í•´(%)</td><td id="crit_dmg"></td></tr>
            <tr><td><img src="/images/stat-weak_rate.png" alt="ì•½ê³µ" class="stat-icon"/>ì•½ì  ê³µê²© í™•ë¥ (%)</td><td id="weak_rate"></td></tr>
            <tr><td><img src="/images/stat-block_rate.png" alt="ë§‰ê¸°" class="stat-icon"/>ë§‰ê¸° í™•ë¥ (%)</td><td id="block_rate"></td></tr>
            <tr><td><img src="/images/stat-dmg_reduce.png" alt="ë°›í”¼ê°" class="stat-icon"/>ë°›ëŠ” í”¼í•´ ê°ì†Œ(%)</td><td id="dmg_reduce"></td></tr>
            <tr><td><img src="/images/stat-eff_hit.png" alt="íš¨ê³¼ ì ì¤‘" class="stat-icon"/>íš¨ê³¼ ì ì¤‘(%)</td><td id="eff_hit"></td></tr>
            <tr><td><img src="/images/stat-eff_res.png" alt="íš¨ê³¼ ì €í•­" class="stat-icon"/>íš¨ê³¼ ì €í•­(%)</td><td id="eff_res"></td></tr>
          </table>
        </div>

        <!-- ìš°ì¸¡: ì´ˆì›” ìŠ¤íƒ¯ -->
        <div class="stats-right">
          <h3 class="transcendence-title">ì´ˆì›” ë‹¨ê³„ë³„ ìŠ¤íƒ¯</h3>
          <div id="transcendence-levels" class="transcendence-levels">
            <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
          </div>
        </div>
      </section>
    </div>

    <div class="tab-content" id="tab-skills">
      <section class="hero-skills">
        <div class="skill attack-skill">
          <div class="skill-main">
            <h3>ê¸°ë³¸ ê³µê²©</h3>
            <img id="attack-image" alt="ê³µê²© ì´ë¯¸ì§€" loading="lazy" />
            <p><strong id="attack-name" class="skill-name"></strong> <span id="attack-cooltime" class="skill-cooltime"></span></p>
            <div id="attack-desc" class="skill-desc"></div>
          </div>
          <div id="attack-effects" class="skill-effects"></div>
        </div>

        <!-- Active Skill 1 - ë™ì  ë Œë”ë§ -->
        <div id="active-1-container"></div>

        <div class="skill active-skill-2">
          <div class="skill-main">
            <h3>ì•¡í‹°ë¸Œ ìŠ¤í‚¬ 2</h3>
            <img id="active-2-image" alt="ì•¡í‹°ë¸Œ ìŠ¤í‚¬ 2 ì´ë¯¸ì§€" loading="lazy" />
            <p><strong id="active-2-name" class="skill-name"></strong> <span id="active-2-cooltime" class="skill-cooltime"></span></p>
            <div id="active-2-desc" class="skill-desc"></div>
          </div>
          <div id="active-2-effects" class="skill-effects"></div>
        </div>
        <div class="skill passive-skill">
          <div class="skill-main">
            <h3>íŒ¨ì‹œë¸Œ</h3>
            <img id="passive-image" alt="íŒ¨ì‹œë¸Œ ì´ë¯¸ì§€" loading="lazy" />
            <p><strong id="passive-name" class="skill-name"></strong> <span id="passive-cooltime" class="skill-cooltime"></span></p>
            <div id="passive-desc" class="skill-desc"></div>
          </div>
          <div id="passive-effects" class="skill-effects"></div>
        </div>
      </section>
    </div>

    <div class="tab-content" id="tab-comments">
      <section class="hero-comments">
        <form id="comment-form">
          <input type="text" id="nickname" name="nickname" placeholder="ë‹‰ë„¤ì„" required />

          <!-- Star Rating Input -->
          <div class="rating-input-container">
            <label for="rating-input" class="rating-label">
              <i class="ph-fill ph-star"></i>
              í‰ê°€
            </label>
            <div class="star-rating-input" id="star-rating-input">
              <span class="star" data-rating="1">â˜…</span>
              <span class="star" data-rating="2">â˜…</span>
              <span class="star" data-rating="3">â˜…</span>
              <span class="star" data-rating="4">â˜…</span>
              <span class="star" data-rating="5">â˜…</span>
            </div>
            <input type="hidden" id="rating-value" name="rating" value="0" required />
          </div>

          <textarea id="comment-content" name="content" placeholder="ì˜ê²¬ì„ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
          <button type="submit">ë“±ë¡</button>
        </form>
        <ul id="comment-list" class="comment-list"></ul>
      </section>
    </div>

    <!-- âœ… ê°€ì´ë“œ íƒ­ ì¶”ê°€ -->
    <div class="tab-content" id="tab-guide">
      <section class="hero-guide">

        <!-- í•œëˆˆì— ë³´ê¸° ì„¹ì…˜ -->
        <div class="guide-section">
          <h2 class="guide-section-title">
            <i class="ph-bold ph-star"></i>
            í•œëˆˆì— ë³´ê¸°
          </h2>
          <div class="guide-overview">
            <div class="overview-item">
              <span class="overview-label">â­ í‹°ì–´</span>
              <span class="overview-value" id="guide-tier">PVP S / PVE A</span>
            </div>
            <div class="overview-item">
              <span class="overview-label">ğŸ¯ ì£¼ìš” ìš©ë„</span>
              <span class="overview-value" id="guide-role">ê²°íˆ¬ì¥, ì´ë ¥ì „</span>
            </div>
            <div class="overview-item">
              <span class="overview-label">ğŸ’ íšë“</span>
              <span class="overview-value" id="guide-obtain">ì¼ë°˜ ê°€ì± </span>
            </div>
            <div class="overview-item">
              <span class="overview-label">ğŸ‘¥ ì¶”ì²œ íŒŒí‹°</span>
              <span class="overview-value" id="guide-party">ê´€ë ¨ ì˜ì›…ë“¤</span>
            </div>
            <div class="overview-item">
              <span class="overview-label">ğŸ”° ì´ˆë³´ì ì¶”ì²œë„</span>
              <span class="overview-value" id="guide-beginner">â˜…â˜…â˜…â˜…â˜†</span>
            </div>
          </div>
        </div>

        <!-- ì¶”ì²œ ì¥ë¹„ ì„¸íŒ… ì„¹ì…˜ -->
        <div class="guide-section">
          <h2 class="guide-section-title">
            <i class="ph-bold ph-sword"></i>
            ì¶”ì²œ ì¥ë¹„ ì„¸íŒ…
          </h2>

          <!-- PVE ë¹Œë“œ -->
          <div class="equipment-build">
            <h3 class="build-title">
              <span class="build-badge build-pve">PVE</span>
              ìŠ¤í† ë¦¬ / ë ˆì´ë“œ ë¹Œë“œ
            </h3>
            <div class="equipment-grid">
              <div class="equipment-item">
                <div class="equipment-slot">ë¬´ê¸°</div>
                <div class="equipment-details">
                  <p class="equipment-name">ìƒëª… ì„¸íŠ¸ ë¬´ê¸°</p>
                  <p class="equipment-desc">ì£¼ì˜µì…˜: ê³µê²©ë ¥ / ë¶€ì˜µì…˜: HP, ë°©ì–´ë ¥</p>
                  <p class="equipment-reason"><strong>ì´ìœ :</strong> ìƒì¡´ë ¥ì„ ë†’ì´ë©´ì„œ ë”œëŸ‰ í™•ë³´</p>
                </div>
              </div>
              <div class="equipment-item">
                <div class="equipment-slot">ë°©ì–´êµ¬</div>
                <div class="equipment-details">
                  <p class="equipment-name">ìƒëª… ì„¸íŠ¸ ë°©ì–´êµ¬</p>
                  <p class="equipment-desc">ì£¼ì˜µì…˜: HP, ë°©ì–´ë ¥</p>
                </div>
              </div>
              <div class="equipment-item">
                <div class="equipment-slot">ì•…ì„¸ì„œë¦¬</div>
                <div class="equipment-details">
                  <p class="equipment-name">ìƒëª…ë ¥ ëª©ê±¸ì´</p>
                  <p class="equipment-desc">ìƒì¡´ ìµœìš°ì„ </p>
                </div>
              </div>
            </div>
            <div class="build-summary">
              <p><strong>ì„¸íŠ¸ íš¨ê³¼ ì¶”ì²œ:</strong> ìƒëª… 4ì„¸íŠ¸ (HP +30%)</p>
              <p><strong>ì˜µì…˜ ìš°ì„ ìˆœìœ„:</strong> ê³µê²©ë ¥ â‰¥ HP &gt; ë°©ì–´ë ¥ &gt; ì¹˜ëª…íƒ€</p>
            </div>
          </div>

          <!-- PVP ë¹Œë“œ -->
          <div class="equipment-build">
            <h3 class="build-title">
              <span class="build-badge build-pvp">PVP</span>
              ê²°íˆ¬ì¥ ë¹Œë“œ
            </h3>
            <div class="equipment-grid">
              <div class="equipment-item">
                <div class="equipment-slot">ë¬´ê¸°</div>
                <div class="equipment-details">
                  <p class="equipment-name">ìˆ˜í˜¸ ì„¸íŠ¸ ë¬´ê¸°</p>
                  <p class="equipment-desc">ì£¼ì˜µì…˜: ë°©ì–´ë ¥, HP</p>
                </div>
              </div>
              <div class="equipment-item">
                <div class="equipment-slot">ë°©ì–´êµ¬</div>
                <div class="equipment-details">
                  <p class="equipment-name">ìˆ˜í˜¸ ì„¸íŠ¸ ë°©ì–´êµ¬</p>
                  <p class="equipment-desc">ì£¼ì˜µì…˜: HP, ë°©ì–´ë ¥</p>
                </div>
              </div>
              <div class="equipment-item">
                <div class="equipment-slot">ì•…ì„¸ì„œë¦¬</div>
                <div class="equipment-details">
                  <p class="equipment-name">ìƒëª…ë ¥ ëª©ê±¸ì´</p>
                </div>
              </div>
            </div>
            <div class="build-summary">
              <p><strong>ì„¸íŠ¸ íš¨ê³¼:</strong> ìˆ˜í˜¸ 4ì„¸íŠ¸ (ë°©ì–´ë ¥ +30%)</p>
              <p><strong>ì˜µì…˜ ìš°ì„ ìˆœìœ„:</strong> HP &gt; ë°©ì–´ë ¥ &gt; ê³µê²©ë ¥</p>
            </div>
          </div>
        </div>

        <!-- ìŠ¤í‚¬ ë¹Œë“œ ì„¹ì…˜ -->
        <div class="guide-section">
          <h2 class="guide-section-title">
            <i class="ph-bold ph-lightning"></i>
            ìŠ¤í‚¬ ë¹Œë“œ
          </h2>
          <div class="skill-priority">
            <h3>ìŠ¤í‚¬ì—… ìš°ì„ ìˆœìœ„</h3>
            <ol class="priority-list">
              <li><strong>ê¶ê·¹ê¸°</strong> - ìµœìš°ì„ ! í•µì‹¬ ìŠ¤í‚¬</li>
              <li><strong>2ë²ˆ ìŠ¤í‚¬</strong> - ì£¼ë ¥ ë”œë§/ìœ í‹¸ë¦¬í‹°</li>
              <li><strong>1ë²ˆ ìŠ¤í‚¬</strong> - ë§ˆì§€ë§‰</li>
            </ol>
            <p class="skill-reason">
              <strong>ì´ìœ :</strong> ê¶ê·¹ê¸°ì™€ 2ë²ˆ ìŠ¤í‚¬ì´ ì˜ì›…ì˜ í•µì‹¬ ì—­í• ì„ ë‹´ë‹¹í•˜ë¯€ë¡œ ìµœìš°ì„  íˆ¬ì
            </p>
          </div>
        </div>

        <!-- íŒŒí‹° ì¡°í•© ì¶”ì²œ -->
        <div class="guide-section">
          <h2 class="guide-section-title">
            <i class="ph-bold ph-users-three"></i>
            íŒŒí‹° ì¡°í•© ì¶”ì²œ
          </h2>
          <div class="party-composition">
            <div class="synergy-group">
              <h3>ì‹œë„ˆì§€ ì¢‹ì€ ì˜ì›…</h3>
              <div class="synergy-heroes" id="synergy-heroes">
                <p class="guide-placeholder">ì˜ì›… ë°ì´í„°ì™€ ì—°ë™í•˜ì—¬ ì¶”ì²œ íŒŒí‹°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤</p>
              </div>
            </div>
            <div class="synergy-group">
              <h3>ì¹´ìš´í„° ì˜ì›… (ì£¼ì˜)</h3>
              <div class="counter-heroes" id="counter-heroes">
                <p class="guide-placeholder">ìƒì„±ì´ ë¶ˆë¦¬í•œ ì˜ì›…ë“¤ì„ í‘œì‹œí•©ë‹ˆë‹¤</p>
              </div>
            </div>
          </div>
        </div>

        <!-- ìœ¡ì„± ê°€ì´ë“œ -->
        <div class="guide-section">
          <h2 class="guide-section-title">
            <i class="ph-bold ph-trend-up"></i>
            ìœ¡ì„± ê°€ì´ë“œ
          </h2>
          <div class="growth-guide">
            <h3>ì´ˆë°˜ ìœ¡ì„± ìˆœì„œ</h3>
            <ol class="growth-steps">
              <li>4ì„±ê¹Œì§€ ìš°ì„  ìŠ¹ê¸‰ (í•µì‹¬ ìŠ¤í‚¬ í•´ê¸ˆ)</li>
              <li>ì¥ë¹„ëŠ” ìƒëª… ì„¸íŠ¸ ìš°ì„  ì°©ìš©</li>
              <li>ìŠ¤í‚¬ë¶ì€ ê¶ê·¹ê¸°ì— íˆ¬ì</li>
            </ol>

            <h3>ê°ì„± ìš°ì„ ìˆœìœ„</h3>
            <ul class="awakening-priority">
              <li>1ì°¨ ê°ì„±: ê³µê²©ë ¥ ì¦ê°€ ì„ íƒ</li>
              <li>2ì°¨ ê°ì„±: HP ì¦ê°€ ì„ íƒ</li>
            </ul>

            <h3>íˆ¬ì ê°€ì¹˜</h3>
            <div class="investment-rating">
              <p><strong>í‰ê°€:</strong> â˜…â˜…â˜…â˜…â˜… (5/5)</p>
              <div class="pros-cons">
                <div class="pros">
                  <h4>ì¥ì </h4>
                  <ul>
                    <li>ë²”ìš©ì„±ì´ ë†’ìŒ</li>
                    <li>ì´ˆë°˜ë¶€í„° í›„ë°˜ê¹Œì§€ í™œìš© ê°€ëŠ¥</li>
                    <li>ìœ¡ì„± ë‚œì´ë„ ë‚®ìŒ</li>
                  </ul>
                </div>
                <div class="cons">
                  <h4>ë‹¨ì </h4>
                  <ul>
                    <li>íŠ¹ì • ì½˜í…ì¸ ì—ì„œ ì œí•œì </li>
                    <li>ê³ ê¸‰ ì½˜í…ì¸ ì—ì„œëŠ” ì „ë¬¸ ì˜ì›…ì— ë°€ë¦¼</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ -->
        <div class="guide-section">
          <h2 class="guide-section-title">
            <i class="ph-bold ph-question"></i>
            ìì£¼ ë¬»ëŠ” ì§ˆë¬¸
          </h2>
          <div class="hero-faq">
            <div class="faq-item">
              <h3 class="faq-question">Q: ì´ ì˜ì›…ì€ ë¦¬ì„¸ë§ˆë¼ì—ì„œ ë…¸ë ¤ì•¼ í•˜ë‚˜ìš”?</h3>
              <p class="faq-answer">A: í•„ìˆ˜ëŠ” ì•„ë‹ˆì§€ë§Œ, ìˆìœ¼ë©´ ì´ˆë°˜ ì§„í–‰ì´ ë§¤ìš° í¸í•©ë‹ˆë‹¤.</p>
            </div>
            <div class="faq-item">
              <h3 class="faq-question">Q: ì´ˆë°˜ì— í‚¤ìš¸ ê°€ì¹˜ê°€ ìˆë‚˜ìš”?</h3>
              <p class="faq-answer">A: â˜…â˜…â˜…â˜…â˜… ì ê·¹ ì¶”ì²œ! ì´ˆë°˜ ìŠ¤í† ë¦¬ ì§„í–‰ì— ë§¤ìš° ìœ ìš©í•©ë‹ˆë‹¤.</p>
            </div>
            <div class="faq-item">
              <h3 class="faq-question">Q: ì¥ë¹„ëŠ” ì–´ë–¤ ì„¸íŠ¸ë¥¼ ë§ì¶°ì•¼ í•˜ë‚˜ìš”?</h3>
              <p class="faq-answer">A: PVEëŠ” ìƒëª… ì„¸íŠ¸, PVPëŠ” ìˆ˜í˜¸ ì„¸íŠ¸ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤.</p>
            </div>
          </div>
        </div>

        <!-- ê°€ì´ë“œ ì—…ë°ì´íŠ¸ ì •ë³´ -->
        <div class="guide-footer">
          <p class="guide-update-info">
            <i class="ph-bold ph-calendar"></i>
            ì´ ê°€ì´ë“œëŠ” ì»¤ë®¤ë‹ˆí‹° ê¸°ì—¬ìë“¤ì˜ ë…¸í•˜ìš°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.
          </p>
          <p class="guide-disclaimer">
            â€» ë©”íƒ€ ë³€í™”ì— ë”°ë¼ ì¶”ì²œ ì‚¬í•­ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœì‹  íŒ¨ì¹˜ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.
          </p>
        </div>

      </section>
    </div>
    <!-- âœ… ê°€ì´ë“œ íƒ­ ë -->

    <!-- ê´€ë ¨ ì˜ì›… ì„¹ì…˜ (ë‚´ë¶€ ë§í¬ ê°•í™”) -->
    <section class="related-heroes-section">
      <h2 class="section-title">
        <i class="ph-bold ph-link"></i>
        ê´€ë ¨ ì˜ì›… ë”ë³´ê¸°
      </h2>
      <p class="section-subtitle">ì´ ì˜ì›…ê³¼ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ì¢‹ì€ ì˜ì›…ë“¤ì„ í™•ì¸í•´ë³´ì„¸ìš”</p>
      <div id="related-heroes-grid" class="related-heroes-grid">
        <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
      </div>
    </section>

    <div class="tab-content" id="tab-history">
      <section class="hero-history">
        <div id="history-timeline" class="history-timeline">
          <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
        </div>
      </section>
    </div>
    </div>
      </div>

  <script>
    const heroName = window.heroId;
    const heroId = heroName ? heroName : null;

    if (!heroId) {
      document.querySelector("main").innerHTML = "<p>ìœ íš¨í•˜ì§€ ì•Šì€ ì˜ì›… IDì…ë‹ˆë‹¤.</p>";
    } else {
      const skeleton = document.getElementById("hero-skeleton");
      const container = document.querySelector(".hero-detail-container");
      if (container && skeleton) {
        container.classList.add("loading");
        skeleton.style.display = "block";
      }

      // âœ… íš¨ê³¼ ë°ì´í„°ì™€ ì˜ì›… ë°ì´í„°ë¥¼ ë™ì‹œì— ê°€ì ¸ì˜¤ê¸°
      Promise.all([
        fetch(`/api/hero/name/${encodeURIComponent(heroId)}`, { cache: 'no-store' }).then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        }),
        fetch('/api/effects', { cache: 'no-store' }).then(res => {
          if (!res.ok) {
            console.warn('Effects fetch failed, continuing without effects');
            return [];
          }
          return res.json();
        })
      ])
        .then(([hero, effectsData]) => {
          console.log(`ğŸ“Š Effects loaded: ${effectsData.length} effects`);

          // âœ… Effectsë¥¼ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆë„ë¡ Map ìƒì„±
          const effectsMap = new Map();
          effectsData.forEach(effect => {
            effectsMap.set(effect.name, effect);
          });

          return { hero, effectsMap };
        })
        .then(({ hero, effectsMap }) => {
          if (container && skeleton) {
            container.classList.remove("loading");
            skeleton.style.display = "none";
          }
          if (!hero || !hero.name) {
            document.querySelector("main").innerHTML = "<p>ì˜ì›… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
          }

          // === (êµ¬)ì„¸ë¸ë‚˜ì´ì¸  ì „ìš© data-group ì†ì„± ì¶”ê°€ ===
          if (hero.group) {
            const pageContainer = document.querySelector(".hero-detail-page");
            if (pageContainer) {
              pageContainer.setAttribute("data-group", hero.group);
              if (hero.group.includes("(êµ¬)ì„¸ë¸ë‚˜ì´ì¸ ")) {
                pageContainer.classList.add("old-sevenknights");
                console.log(`ğŸ’œ (êµ¬)ì„¸ë¸ë‚˜ì´ì¸  ê·¸ë£¹ ê°ì§€ë¨ â†’ ${hero.name}`);
              } else {
                console.log(`ğŸ’› ì¼ë°˜ ê·¸ë£¹ â†’ ${hero.name}`);
              }
            }
          }

          // Update SEO meta tags dynamically
          const heroTitle = `${hero.name} (${hero.rarity} / ${hero.type}) - ì„¸ë‚˜DB`;
          document.title = heroTitle;
          const titleEl = document.getElementById("dynamic-title");
          if (titleEl) titleEl.textContent = heroTitle;

          // í’ë¶€í•˜ê³  ê°€ì´ë“œ ìŠ¤íƒ€ì¼ì˜ ì„¤ëª… ë° í‚¤ì›Œë“œ
          const groupText = hero.group || "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤";
          const guideDesc = `ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ${hero.name} ì™„ë²½ ê³µëµ: ìŠ¤í‚¬, ì„±ëŠ¥, ì¥ë¹„, ì¶”ì²œ ì„¸íŒ…, í™œìš©ë²•ê¹Œì§€ ì´ì •ë¦¬! ${groupText} ì†Œì† ${hero.rarity} ë“±ê¸‰ ${hero.type} ì˜ì›…ì˜ ìŠ¤íƒ¯, ìŠ¤í‚¬ ì •ë³´, ì¥ì ê³¼ ë‹¨ì , íŒŒí‹° ì¡°í•©, ì¶”ì²œ ì¥ë¹„, ì„±ì¥ íŒ, PvE/PvP í™œìš©ë²• ë“± ëª¨ë“  ì •ë³´ë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.`;
          const desc = guideDesc;
          const url = `${location.origin}${location.pathname}?id=${encodeURIComponent(heroId)}`;

          // <h1> ì—…ë°ì´íŠ¸
          const heading = document.getElementById("hero-guide-heading");
          if (heading) heading.textContent = `ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ${hero.name} ì™„ë²½ ê³µëµ: ìŠ¤í‚¬, ì„±ëŠ¥, ì¥ë¹„ ì´ì •ë¦¬`;

          // Description
          const descMeta = document.getElementById("meta-description");
          if (descMeta) descMeta.setAttribute("content", desc);

          // Keywords: ì˜ì›…ëª…, ì†Œì†, íƒ€ì…, í¬ê·€ë„, ê°€ì´ë“œ/ê³µëµ ê´€ë ¨ ê²€ìƒ‰ì–´ í¬í•¨
          const keywordsMeta = document.getElementById("meta-keywords");
          if (keywordsMeta) {
            const keywordsArr = [
              "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤", "Seven Knights Re:birth", "ì˜ì›…", "ìƒì„¸", "ë„ê°", "ê³µëµ", "ê°€ì´ë“œ", "ìŠ¤í‚¬", "ì„±ëŠ¥", "ì¥ë¹„", "ì¶”ì²œ", "ì„¸íŒ…", "ì¡°í•©", "ì„±ì¥", "íŒ", "PVP", "PVE", "íŒŒí‹°", "í™œìš©ë²•",
              hero.name, hero.nickname, groupText, hero.type, hero.rarity
            ];
            // Remove duplicates and falsy
            const keywords = Array.from(new Set(keywordsArr.filter(Boolean))).join(", ");
            keywordsMeta.setAttribute("content", keywords);
          }

          // Open Graph
          const ogTitle = document.getElementById("og-title");
          if (ogTitle) ogTitle.setAttribute("content", heroTitle);
          const ogDescEl = document.getElementById("og-description");
          if (ogDescEl) ogDescEl.setAttribute("content", desc);
          const ogImage = document.getElementById("og-image");
          if (ogImage) ogImage.setAttribute("content", hero.portrait || "/default-hero-og-image.png");
          const ogUrl = document.getElementById("og-url");
          if (ogUrl) ogUrl.setAttribute("content", url);

          // Twitter Card
          const twTitle = document.getElementById("twitter-title");
          if (twTitle) twTitle.setAttribute("content", heroTitle);
          const twDesc = document.getElementById("twitter-description");
          if (twDesc) twDesc.setAttribute("content", desc);
          const twImage = document.getElementById("twitter-image");
          if (twImage) twImage.setAttribute("content", hero.portrait || "/default-hero-og-image.png");

          // Canonical
          const canonical = document.getElementById("canonical-link");
          if (canonical) canonical.setAttribute("href", url);

          // âœ… êµ¬ì¡°í™” ë°ì´í„°(JSON-LD) ë™ì  ìƒì„± (VideoGameCharacter + Article)
          const keywordsArr = [
            "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤", "Seven Knights Re:birth", "ì˜ì›…", "ìƒì„¸", "ë„ê°", "ê³µëµ", "ê°€ì´ë“œ", "ìŠ¤í‚¬", "ì„±ëŠ¥", "ì¥ë¹„", "ì¶”ì²œ", "ì„¸íŒ…", "ì¡°í•©", "ì„±ì¥", "íŒ", "PVP", "PVE", "íŒŒí‹°", "í™œìš©ë²•",
            hero.name, hero.nickname, groupText, hero.type, hero.rarity
          ];
          const jsonLdObj = [
            {
              "@context": "https://schema.org",
              "@type": "VideoGameCharacter",
              "name": hero.name,
              "alternateName": hero.nickname || undefined,
              "description": desc,
              "image": hero.portrait || "/default-hero-og-image.png",
              "url": url,
              "inLanguage": "ko",
              "rarity": hero.rarity,
              "characterAttribute": hero.type,
              "memberOf": groupText,
              "isPartOf": {
                "@type": "VideoGame",
                "name": "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ (Seven Knights Re:birth)"
              }
            },
            {
              "@context": "https://schema.org",
              "@type": "Article",
              "headline": `ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ${hero.name} ì™„ë²½ ê³µëµ: ìŠ¤í‚¬, ì„±ëŠ¥, ì¥ë¹„ ì´ì •ë¦¬`,
              "articleSection": "ì˜ì›… ê°€ì´ë“œ, ìƒì„¸ ì •ë³´, ìŠ¤í‚¬/ì„±ëŠ¥/ì¥ë¹„ ë¶„ì„",
              "about": hero.name,
              "author": { "@type": "Organization", "name": "ì„¸ë‚˜DB" },
              "inLanguage": "ko",
              "image": hero.portrait || "/default-hero-og-image.png",
              "datePublished": hero.datePublished || undefined,
              "dateModified": hero.dateModified || undefined,
              "mainEntityOfPage": url,
              "keywords": Array.from(new Set(keywordsArr.filter(Boolean))).join(", "),
              "description": desc,
              "url": url
            }
          ];
          const jsonLdEl = document.querySelector('script[type="application/ld+json"]');
          if (jsonLdEl) {
            jsonLdEl.textContent = JSON.stringify(jsonLdObj, null, 2);
          }

          // === Hero portrait area rendering (index.html card logic adapted) ===
          (function renderHeroPortrait() {
            // Remove existing children
            const wrap = document.querySelector(".hero-portrait-wrap");
            if (!wrap) return;
            wrap.innerHTML = "";
            wrap.style.position = "relative";

            // Determine rarityClass (for border/background)
            const rarityClass = (() => {
              switch (hero.rarity) {
                case "ì „ì„¤+": return "legendary-plus";
                case "ì „ì„¤": return "legendary";
                case "í¬ê·€": return "rare";
                case "ê³ ê¸‰": return "uncommon";
                default: return "normal";
              }
            })();

            // Portrait img
            const img = document.createElement("img");
            img.className = `hero-portrait rarity-${rarityClass}`;
            img.alt = "ì˜ì›… ì´ˆìƒí™”";
            img.src = hero.portrait || "";

            img.addEventListener('error', function() {
              console.warn(`ì´ˆìƒí™” ë¡œë“œ ì‹¤íŒ¨: ${hero.name}`);
              this.style.display = 'none'; // Hide broken image
            });

            // Add shine border if hasEffect
            if (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1) {
              img.classList.add("has-effect");
            }
            wrap.appendChild(img);

            // Rarity border PNG if hasEffect
            if (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1) {
              const isOldSevenKnights = hero.group && hero.group.includes("(êµ¬)ì„¸ë¸ë‚˜ì´ì¸ ");
              const borderImg = document.createElement("img");
              borderImg.className = "rarity-border";
              borderImg.src = isOldSevenKnights
                ? "/images/border-legendary-oldsena.png"
                : "/images/border-legendary.png";
              borderImg.alt = "ì „ì„¤ í…Œë‘ë¦¬";
              wrap.appendChild(borderImg);
            }

            // Type badge (if hero.typeImage)
            if (hero.typeImage) {
              const badge = document.createElement("img");
              badge.className = "hero-type-badge";
              badge.src = hero.typeImage;
              badge.alt = hero.type || "íƒ€ì…";
              badge.style.position = "absolute";
              badge.style.left = "8px";
              badge.style.bottom = "8px";
              badge.style.width = "28px";
              badge.style.height = "28px";
              badge.style.zIndex = "2";
              wrap.appendChild(badge);
            }
          })();
          document.getElementById("hero-name").textContent = hero.name || "";
          document.getElementById("hero-nickname").textContent = hero.nickname || "";
          document.getElementById("hero-group").textContent = hero.group || "";

          // Set hero type with icon and color class
          const heroTypeEl = document.getElementById("hero-type");
          heroTypeEl.innerHTML = ""; // Clear previous content

          // Add type icon if available
          if (hero.typeImage) {
            const typeIcon = document.createElement("img");
            typeIcon.src = hero.typeImage;
            typeIcon.alt = hero.type || "íƒ€ì…";
            typeIcon.className = "hero-type-icon";
            typeIcon.style.width = "20px";
            typeIcon.style.height = "20px";
            typeIcon.style.marginRight = "6px";
            typeIcon.style.verticalAlign = "middle";
            heroTypeEl.appendChild(typeIcon);
          }

          // Add type text
          const typeText = document.createTextNode(hero.type || "");
          heroTypeEl.appendChild(typeText);

          const typeClassMap = {
            "ê³µê²©í˜•": "type-attack",
            "ë§ˆë²•í˜•": "type-magic",
            "ì§€ì›í˜•": "type-support",
            "ë§ŒëŠ¥í˜•": "type-versatile",
            "ë°©ì–´í˜•": "type-defense"
          };
          const typeClass = typeClassMap[hero.type];
          if (typeClass) {
            heroTypeEl.className = "hero-type " + typeClass;
          }

          // Set hero rarity with color class
          const heroRarityEl = document.getElementById("hero-rarity");
          heroRarityEl.textContent = hero.rarity || "";
          const rarityClassMap = {
            "ì „ì„¤+": "rarity-legendary-plus",
            "ì „ì„¤": "rarity-legendary",
            "í¬ê·€": "rarity-rare"
          };
          const rarityClass = rarityClassMap[hero.rarity];
          if (rarityClass) {
            heroRarityEl.className = "hero-rarity " + rarityClass;
          }

          // ìŠ¤íƒ¯
          const statFields = ["atk","def","hp","spd","crit_rate","crit_dmg","weak_rate","block_rate","dmg_reduce","eff_hit","eff_res"];
          statFields.forEach(field => {
            document.getElementById(field).textContent = hero[field] || "-";
          });

          // ìŠ¤í‚¬ ì¶œë ¥ í•¨ìˆ˜
          // Simple markdown parser for skill descriptions
          const parseMarkdown = (text) => {
            if (!text) return "";

            // Helper function to parse markdown within a sentence
            const parseMarkdownInline = (sentence) => {
              // Handle null/undefined/non-string values
              if (!sentence || typeof sentence !== 'string') return '';

              // Remove leading \- (backslash-dash-space) from bullet points
              let html = sentence.replace(/^\\-\s+/, '');

              // Escape HTML to prevent XSS
              html = html
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');

              // Parse markdown (in order of precedence)
              html = html
                // Bold: **text** or __text__
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/__(.+?)__/g, '<strong>$1</strong>')
                // Italic: *text* or _text_ (but not inside words)
                .replace(/(?<!\w)\*(.+?)\*(?!\w)/g, '<em>$1</em>')
                .replace(/(?<!\w)_(.+?)_(?!\w)/g, '<em>$1</em>')
                // Code: `text`
                .replace(/`(.+?)`/g, '<code>$1</code>')
                // Links: [text](url)
                .replace(/\[(.+?)\]\((.+?)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>');

              return html;
            };

            // âœ… Process effect markers <<íš¨ê³¼ëª…>> or <<íš¨ê³¼ëª…, ë³€ìˆ˜>>
            const processEffectMarker = (sentence) => {
              const effectPattern = /^<<(.+?)(?:,\s*(.+?))?>>$/;
              const match = sentence.match(effectPattern);

              if (!match) {
                return null; // Not an effect marker
              }

              const effectName = match[1].trim();
              const variableValue = match[2] ? match[2].trim() : null;

              // Find effect in effectsMap
              const effect = effectsMap.get(effectName);

              if (!effect) {
                console.warn(`âš ï¸ Effect not found: ${effectName}`);
                return `<div class="skill-effect-box skill-effect-unknown"><strong>íš¨ê³¼ ì—†ìŒ</strong> ${parseMarkdownInline(effectName)}</div>`;
              }

              // Process description with variable substitution
              // Ensure description is a string (handle arrays, objects, etc.)
              let description = '';
              if (effect.description) {
                if (Array.isArray(effect.description)) {
                  description = effect.description.join(' ');
                } else if (typeof effect.description === 'object') {
                  // Handle {state, value, isStale} object structure
                  description = effect.description.value || JSON.stringify(effect.description);
                } else {
                  description = String(effect.description);
                }
              }

              if (effect.hasVariable && variableValue && description) {
                // Replace 'n' with the variable value
                description = description.replace(/n/g, variableValue);
              }

              // Render effect box with title/desc structure
              const effectTypeClass = effect.effectType ? `skill-effect-${effect.effectType}` : '';
              const iconHtml = effect.icon
                ? `<img src="${effect.icon}" alt="${effect.name}" class="effect-icon" loading="lazy" />`
                : '';

              // Display: íš¨ê³¼ëª…ë§Œ (ë³€ìˆ˜ëŠ” descì—ì„œë§Œ ì¹˜í™˜)
              const titleContent = `${iconHtml}${effect.name}`;

              return `<div class="skill-effect-box skill-effect-custom ${effectTypeClass}">
  <div class="effect-title">${titleContent}</div>
  <div class="effect-desc">${parseMarkdownInline(description)}</div>
</div>`;
            };

            // Process a sentence to check for target markers
            const processTargetMarker = (sentence) => {
              if (!sentence.startsWith('!')) {
                return parseMarkdownInline(sentence);
              }

              // Remove the ! marker
              const content = sentence.substring(1);

              // Define target type patterns (in priority order)
              const targetPatterns = [
                // ì êµ° ë‹¤ì¤‘ (ê°€ì¥ ìš°ì„ )
                {
                  pattern: /^(?:ëª¨ë“  ì êµ°|ì „ì²´ ì êµ°|ì êµ° \d+ëª…)/,
                  type: 'target-enemy-multi'
                },
                // ì êµ° ë‹¨ì¼
                {
                  pattern: /^(?:ë‹¨ì¼ ì êµ°|(?:ê³µê²©ë ¥|ë°©ì–´ë ¥|ìƒëª…ë ¥|ì²´ë ¥|ì†ê³µ)ì´ ê°€ì¥ (?:ë†’ì€|ë‚®ì€) ì êµ°|ë¬´ì‘ìœ„ ì êµ° 1ëª…|ëŒ€ìƒ ì êµ°|ì êµ° 1ëª…)/,
                  type: 'target-enemy-single'
                },
                // ì•„êµ° ë‹¤ì¤‘
                {
                  pattern: /^(?:ëª¨ë“  ì•„êµ°|ì „ì²´ ì•„êµ°|ì•„êµ° \d+ëª…|(?:ê³µê²©ë ¥|ë°©ì–´ë ¥|ìƒëª…ë ¥|ì²´ë ¥|ì†ê³µ)ì´ ê°€ì¥ (?:ë†’ì€|ë‚®ì€) ì•„êµ° \d+ëª…)/,
                  type: 'target-ally-multi'
                },
                // ì•„êµ° ë‹¨ì¼
                {
                  pattern: /^(?:ìì‹ |ë‹¨ì¼ ì•„êµ°|(?:ê³µê²©ë ¥|ë°©ì–´ë ¥|ìƒëª…ë ¥|ì²´ë ¥|ì†ê³µ)ì´ ê°€ì¥ (?:ë†’ì€|ë‚®ì€) ì•„êµ°|ëŒ€ìƒ ì•„êµ°|ì•„êµ° 1ëª…)/,
                  type: 'target-ally-single'
                }
              ];

              // Check which target type matches
              for (const { pattern, type } of targetPatterns) {
                if (pattern.test(content)) {
                  return '<div class="skill-target-box ' + type + '">' + parseMarkdownInline(content) + '</div>';
                }
              }

              // No target type found, return as-is with inline markdown (but ! was removed)
              return parseMarkdownInline(content);
            };

            // Split by lines
            const lines = text.split('\n');
            const processedLines = [];

            for (let i = 0; i < lines.length; i++) {
              const line = lines[i].trim();
              if (!line) {
                continue;
              }

              // 6ì´ˆì›” íš¨ê³¼ ì»¨í…Œì´ë„ˆ (@@ë¡œ ì‹œì‘)
              if (line.startsWith('@@')) {
                const effectContent = [];
                i++; // Skip the header line

                // Collect all lines until next marker
                while (i < lines.length) {
                  const nextLine = lines[i].trim();
                  if (!nextLine) {
                    i++;
                    continue;
                  }

                  // Stop if we hit any marker
                  if (nextLine.startsWith('@@') || nextLine.startsWith('@') ||
                      nextLine.startsWith('#') || nextLine.startsWith('<<') ||
                      nextLine.startsWith('!')) {
                    i--; // Back up so outer loop processes this line
                    break;
                  }

                  effectContent.push(parseMarkdownInline(nextLine));
                  i++;
                }

                const effectHtml = `
                  <div class="skill-effect-box awakening-6">
                    <div class="effect-title">
                      <img src="/images/trans-6.png" alt="6ì´ˆì›”" class="effect-icon-img" />
                      6ì´ˆì›” íš¨ê³¼
                    </div>
                    <div class="effect-desc">
                      ${effectContent.map(content => `<p>${content}</p>`).join('')}
                    </div>
                  </div>
                `;
                processedLines.push(effectHtml);
                continue;
              }

              // 2ì´ˆì›” íš¨ê³¼ ì»¨í…Œì´ë„ˆ (@ë¡œ ì‹œì‘)
              if (line.startsWith('@')) {
                const effectContent = [];
                i++; // Skip the header line

                while (i < lines.length) {
                  const nextLine = lines[i].trim();
                  if (!nextLine) {
                    i++;
                    continue;
                  }

                  if (nextLine.startsWith('@@') || nextLine.startsWith('@') ||
                      nextLine.startsWith('#') || nextLine.startsWith('<<') ||
                      nextLine.startsWith('!')) {
                    i--;
                    break;
                  }

                  effectContent.push(parseMarkdownInline(nextLine));
                  i++;
                }

                const effectHtml = `
                  <div class="skill-effect-box awakening-2">
                    <div class="effect-title">
                      <img src="/images/trans-2.png" alt="2ì´ˆì›”" class="effect-icon-img" />
                      2ì´ˆì›” íš¨ê³¼
                    </div>
                    <div class="effect-desc">
                      ${effectContent.map(content => `<p>${content}</p>`).join('')}
                    </div>
                  </div>
                `;
                processedLines.push(effectHtml);
                continue;
              }

              // ìŠ¤í‚¬ ê°•í™” íš¨ê³¼ ì»¨í…Œì´ë„ˆ (#ë¡œ ì‹œì‘)
              if (line.startsWith('#')) {
                const effectContent = [];
                i++; // Skip the header line

                while (i < lines.length) {
                  const nextLine = lines[i].trim();
                  if (!nextLine) {
                    i++;
                    continue;
                  }

                  if (nextLine.startsWith('@@') || nextLine.startsWith('@') ||
                      nextLine.startsWith('#') || nextLine.startsWith('<<') ||
                      nextLine.startsWith('!')) {
                    i--;
                    break;
                  }

                  effectContent.push(parseMarkdownInline(nextLine));
                  i++;
                }

                const effectHtml = `
                  <div class="skill-effect-box skill-enhancement">
                    <div class="effect-title">
                      <img src="/images/enhance.png" alt="ìŠ¤í‚¬ ê°•í™”" class="effect-icon-img" />
                      ìŠ¤í‚¬ ê°•í™” íš¨ê³¼
                    </div>
                    <div class="effect-desc">
                      ${effectContent.map(content => `<p>${content}</p>`).join('')}
                    </div>
                  </div>
                `;
                processedLines.push(effectHtml);
                continue;
              }

              // ì»¤ìŠ¤í…€ íš¨ê³¼ ë§ˆì»¤ - Effects í…Œì´ë¸”ì—ì„œ ê°€ì ¸ì˜¨ íš¨ê³¼
              if (line.startsWith('<<')) {
                const effectHtml = processEffectMarker(line);
                if (effectHtml) {
                  processedLines.push(effectHtml);
                } else {
                  // If effect marker parsing failed, treat as regular line
                  const processedContent = processTargetMarker(line);
                  processedLines.push(processedContent);
                }
              } else {
                // Regular line - check for target marker or process as normal
                const processedContent = processTargetMarker(line);
                processedLines.push(processedContent);
              }
            }

            // Join lines with <br>
            return processedLines.join('<br>');
          };

          // Helper: Separate effects from description
          const separateEffects = (parsedHtml) => {
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = parsedHtml;

            // íš¨ê³¼ í…Œì´ë¸” ì—°ë™ íš¨ê³¼ë¥¼ ë³µì œ (ì œê±°í•˜ì§€ ì•ŠìŒ)
            const customEffectBoxes = tempDiv.querySelectorAll('.skill-effect-box.skill-effect-custom');

            // ì›ë˜ ìœ„ì¹˜ íš¨ê³¼ì— í´ë˜ìŠ¤ ì¶”ê°€ (ë°ìŠ¤í¬íƒ‘ì—ì„œ ìˆ¨ê¹€ìš©)
            customEffectBoxes.forEach(box => {
              box.classList.add('inline-effect');
            });

            // ì˜¤ë¥¸ìª½ ì»¨í…Œì´ë„ˆìš© ë³µì œ (ë°ìŠ¤í¬íƒ‘ ì „ìš©)
            const effectsHtml = Array.from(customEffectBoxes).map(box => {
              const clone = box.cloneNode(true);
              clone.classList.remove('inline-effect');
              clone.classList.add('sidebar-effect');
              return clone.outerHTML;
            }).join('');

            return { descHtml: tempDiv.innerHTML, effectsHtml };
          };

          const renderSkill = (prefix, skill) => {
            document.getElementById(`${prefix}-image`).src = skill?.image || "";
            document.getElementById(`${prefix}-name`).textContent = skill?.name || "";
            const cooltimeEl = document.getElementById(`${prefix}-cooltime`);
            if (skill?.cooltime) {
              cooltimeEl.textContent = `ì¿¨íƒ€ì„: ${skill.cooltime}`;
              cooltimeEl.style.display = '';
            } else {
              cooltimeEl.textContent = "";
              cooltimeEl.style.display = 'none';
            }

            // Parse skill description and separate custom effects
            const parsed = separateEffects(parseMarkdown(skill?.desc || ""));

            // Render separated content
            document.getElementById(`${prefix}-desc`).innerHTML = parsed.descHtml;
            const effectsContainer = document.getElementById(`${prefix}-effects`);
            if (effectsContainer) {
              effectsContainer.innerHTML = parsed.effectsHtml;
            }
          };

          // Render Active Skill 1 (with transformation support)
          const renderActiveSkill1 = (skill, transformedSkill) => {
            const container = document.getElementById('active-1-container');
            if (!container) return;

            const skill1Parsed = separateEffects(parseMarkdown(skill?.desc || ''));
            const skill2Parsed = transformedSkill ? separateEffects(parseMarkdown(transformedSkill?.desc || '')) : null;

            if (transformedSkill) {
              // ë³€í™˜í˜• ìŠ¤í‚¬ - 2ë‹¨ êµ¬ì¡°
              container.innerHTML = `
                <div class="skill skill-transform">
                  <div class="skill-main">
                    <h3>ì•¡í‹°ë¸Œ ìŠ¤í‚¬ 1 <span class="skill-transform-badge">(ë³€í™˜í˜• ìŠ¤í‚¬)</span></h3>
                    <div class="skill-transform-container">
                      <div class="skill-transform-item">
                        <div class="skill-transform-label">ê¸°ë³¸ ìƒíƒœ</div>
                        <img src="${skill?.image || ''}" alt="ì•¡í‹°ë¸Œ ìŠ¤í‚¬ 1" loading="lazy" />
                        <p><strong class="skill-name">${skill?.name || ''}</strong>${skill?.cooltime ? ` <span class="skill-cooltime">ì¿¨íƒ€ì„: ${skill.cooltime}</span>` : ''}</p>
                        <div class="skill-desc">${skill1Parsed.descHtml}</div>
                      </div>
                      <div class="skill-transform-arrow">â†’</div>
                      <div class="skill-transform-item">
                        <div class="skill-transform-label">ë³€í™˜ í›„</div>
                        <img src="${transformedSkill?.image || ''}" alt="ë³€í™˜ í›„" loading="lazy" />
                        <p><strong class="skill-name">${transformedSkill?.name || ''}</strong>${transformedSkill?.cooltime ? ` <span class="skill-cooltime">ì¿¨íƒ€ì„: ${transformedSkill.cooltime}</span>` : ''}</p>
                        <div class="skill-desc">${skill2Parsed.descHtml}</div>
                      </div>
                    </div>
                  </div>
                  <div class="skill-effects">
                    ${skill1Parsed.effectsHtml}
                    ${skill2Parsed.effectsHtml}
                  </div>
                </div>
              `;
            } else {
              // ì¼ë°˜ ìŠ¤í‚¬
              container.innerHTML = `
                <div class="skill active-skill-1">
                  <div class="skill-main">
                    <h3>ì•¡í‹°ë¸Œ ìŠ¤í‚¬ 1</h3>
                    <img src="${skill?.image || ''}" alt="ì•¡í‹°ë¸Œ ìŠ¤í‚¬ 1 ì´ë¯¸ì§€" loading="lazy" />
                    <p><strong class="skill-name">${skill?.name || ''}</strong>${skill?.cooltime ? ` <span class="skill-cooltime">ì¿¨íƒ€ì„: ${skill.cooltime}</span>` : ''}</p>
                    <div class="skill-desc">${skill1Parsed.descHtml}</div>
                  </div>
                  <div class="skill-effects">${skill1Parsed.effectsHtml}</div>
                </div>
              `;
            }
          };

          // Render History Timeline
          const renderHistory = (history) => {
            const timeline = document.getElementById('history-timeline');
            if (!timeline) return;

            if (!history || history.length === 0) {
              timeline.innerHTML = '<p class="history-empty">ì—…ë°ì´íŠ¸ íˆìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
              return;
            }

            timeline.innerHTML = history.map(entry => `
              <div class="history-entry">
                <div class="history-date">${entry.date || ''}</div>
                <div class="history-dot"></div>
                <div class="history-content">
                  ${entry.type ? `<span class="history-type history-type-${entry.type.toLowerCase()}">${entry.type}</span>` : ''}
                  <p class="history-text">${entry.content || ''}</p>
                </div>
              </div>
            `).join('');
          };

          // Render Transcendence Levels
          const renderTranscendence = (transLevelText) => {
            const container = document.getElementById('transcendence-levels');
            if (!container) return;

            if (!transLevelText || transLevelText.trim() === '') {
              container.innerHTML = '<p class="transcendence-empty">ì´ˆì›” ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
              return;
            }

            // Split by double newlines to separate each transcendence level
            const levels = transLevelText.trim().split(/\n\n+/);

            container.innerHTML = levels.map((levelText, index) => {
              const levelNum = index + 1;
              // Replace newlines with <br> for display
              const formattedText = levelText.trim().replace(/\n/g, '<br>');

              return `
                <div class="transcendence-box">
                  <div class="transcendence-level-number">${levelNum}ì´ˆì›”</div>
                  <div class="transcendence-content">${formattedText}</div>
                </div>
              `;
            }).join('');
          };

          renderSkill("attack", hero.attack);
          renderActiveSkill1(hero.active_1, hero.active_1_change);
          renderSkill("active-2", hero.active_2);
          renderSkill("passive", hero.passive);
          renderHistory(hero.history);
          renderTranscendence(hero.transLevel);

          const descEl = document.getElementById("hero-description");
          if (descEl) descEl.textContent = hero.description || "";

          // Breadcrumbì— ì˜ì›… ì´ë¦„ ì„¤ì •
          const breadcrumbName = document.getElementById("breadcrumb-hero-name");
          if (breadcrumbName) breadcrumbName.textContent = hero.name || "ì˜ì›… ìƒì„¸";

          // âœ… ê´€ë ¨ ì˜ì›… ë Œë”ë§ (ë‚´ë¶€ ë§í¬ ê°•í™”)
          renderRelatedHeroes(hero);

        })
        .catch(err => {
          if (container && skeleton) {
            container.classList.remove("loading");
            skeleton.style.display = "none";
          }
          console.error("Hero fetch error:", err);
          document.querySelector("main").innerHTML = "<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>";
        });
    }
</script>

  <script>
    // Star Rating Input
    const starInput = document.getElementById('star-rating-input');
    const ratingValue = document.getElementById('rating-value');

    if (starInput) {
      const stars = starInput.querySelectorAll('.star');
      let currentRating = 0;

      stars.forEach(star => {
        star.addEventListener('mouseenter', () => {
          const rating = parseInt(star.dataset.rating);
          updateStarDisplay(rating, true);
        });

        star.addEventListener('click', () => {
          currentRating = parseInt(star.dataset.rating);
          ratingValue.value = currentRating;
          updateStarDisplay(currentRating, false);
        });
      });

      starInput.addEventListener('mouseleave', () => {
        updateStarDisplay(currentRating, false);
      });

      function updateStarDisplay(rating, isHover) {
        stars.forEach(star => {
          const starRating = parseInt(star.dataset.rating);
          star.classList.remove('selected', 'hovered');

          if (isHover) {
            if (starRating <= rating) {
              star.classList.add('hovered');
            }
          } else {
            if (starRating <= rating) {
              star.classList.add('selected');
            }
          }
        });
      }

      // Expose reset function
      window.resetRating = function() {
        currentRating = 0;
        ratingValue.value = "0";
        stars.forEach(star => star.classList.remove('selected', 'hovered'));
      };
    }
  </script>

  <script>
    const commentForm = document.getElementById("comment-form");
    const commentList = document.getElementById("comment-list");

    // Calculate and display average rating
    function updateAverageRating(comments) {
      const ratingDisplay = document.getElementById('hero-rating-display');
      const avgRatingEl = document.getElementById('average-rating');
      const commentCountEl = document.getElementById('comment-count');

      if (!comments || comments.length === 0) {
        ratingDisplay.style.display = 'none';
        return;
      }

      const ratingsWithValues = comments.filter(c => c.rating && c.rating > 0);

      if (ratingsWithValues.length === 0) {
        ratingDisplay.style.display = 'none';
        return;
      }

      const totalRating = ratingsWithValues.reduce((sum, c) => sum + c.rating, 0);
      const avgRating = (totalRating / ratingsWithValues.length).toFixed(1);

      avgRatingEl.textContent = avgRating;
      commentCountEl.textContent = comments.length;
      ratingDisplay.style.display = 'flex';
    }

    // ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadComments() {
      try {
        const res = await fetch(`/api/comments/${window.heroId}`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        commentList.innerHTML = "";
        (data.comments || []).forEach(comment => {
          const li = document.createElement("li");

          // Create rating stars display
          const rating = comment.rating || 0;
          let ratingHTML = '<div class="comment-rating">';
          for (let i = 1; i <= 5; i++) {
            ratingHTML += `<span class="star ${i <= rating ? '' : 'empty'}">â˜…</span>`;
          }
          ratingHTML += '</div>';

          li.innerHTML = `
            <strong>${comment.nickname}</strong>
            ${ratingHTML}
            <p>${comment.content}</p>
            <span>${comment.timestamp || ""}</span>
          `;
          commentList.appendChild(li);
        });

        // Update average rating display
        updateAverageRating(data.comments || []);
      } catch (err) {
        console.error("ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", err);
      }
    }

    // ëŒ“ê¸€ ë“±ë¡
commentForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const nickname = document.getElementById("nickname").value.trim();
  const content = document.getElementById("comment-content").value.trim();
  const rating = parseInt(document.getElementById("rating-value").value);

  if (!nickname || !content) return alert("ë‹‰ë„¤ì„ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
  if (!rating || rating < 1 || rating > 5) return alert("ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš” (1-5).");

  try {
    // âœ… [ì¶”ê°€ëœ ë¶€ë¶„] ì‹¤ì œë¡œ ì „ì†¡ë˜ëŠ” ë°ì´í„°ë¥¼ ì½˜ì†”ì— ì¶œë ¥
    console.log("ğŸ“© ì „ì†¡ ë°ì´í„°:", { heroId: window.heroId, nickname, content, rating });

    const res = await fetch(`/api/comments/${window.heroId}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ heroId: window.heroId, nickname, content, rating }),
    });

    // âœ… [ì¶”ê°€ëœ ë¶€ë¶„] ì„œë²„ ì‘ë‹µ ìƒíƒœ ì½”ë“œ í™•ì¸
    console.log("ğŸ“© ì„œë²„ ì‘ë‹µ ìƒíƒœ:", res.status);

    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    document.getElementById("comment-content").value = "";
    document.getElementById("nickname").value = "";
    // Reset star rating
    if (window.resetRating) window.resetRating();

    await loadComments();
  } catch (err) {
    console.error("âŒ ëŒ“ê¸€ ë“±ë¡ ì˜¤ë¥˜:", err);
    alert("ëŒ“ê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
  }
});

    // ì´ˆê¸° ë¡œë“œ
    loadComments();
  </script>

  <script>
    // ì˜ì›… ìºëŸ¬ì…€ ë„¤ë¹„ê²Œì´ì…˜
    let allHeroes = [];
    let currentHeroIndex = -1;

    // ì „ì²´ ì˜ì›… ëª©ë¡ ê°€ì ¸ì˜¤ê¸° ë° ìºëŸ¬ì…€ ë Œë”ë§
    fetch('/api/heroes', { cache: 'no-store' })
      .then(res => res.json())
      .then(heroes => {
        console.log('ğŸ“Š ì „ì²´ ì˜ì›… ëª©ë¡:', heroes.length, 'ëª…');
        allHeroes = heroes.sort((a, b) => a.name.localeCompare(b.name, 'ko'));
        currentHeroIndex = allHeroes.findIndex(h => h.name === heroName);
        console.log('ğŸ¯ í˜„ì¬ ì˜ì›…:', heroName, '/ ì¸ë±ìŠ¤:', currentHeroIndex);

        // ìºëŸ¬ì…€ ë Œë”ë§
        const carousel = document.getElementById('hero-carousel');
        if (!carousel) return;

        allHeroes.forEach((hero, index) => {
          const item = document.createElement('div');
          item.className = 'carousel-item';
          if (index === currentHeroIndex) {
            item.classList.add('active');
          }

          // ë“±ê¸‰ë³„ í´ë˜ìŠ¤
          const rarityClass = (() => {
            switch (hero.rarity) {
              case "ì „ì„¤+": return "legendary-plus";
              case "ì „ì„¤": return "legendary";
              case "í¬ê·€": return "rare";
              case "ê³ ê¸‰": return "uncommon";
              default: return "normal";
            }
          })();

          const portrait = document.createElement('img');
          portrait.src = hero.portrait || '';
          portrait.alt = hero.name;
          portrait.className = `carousel-portrait rarity-${rarityClass}`;

          portrait.addEventListener('error', function() {
            this.style.display = 'none';
          });

          // hasEffect íš¨ê³¼ ì¶”ê°€
          if (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1) {
            portrait.classList.add('has-effect');
          }

          item.appendChild(portrait);

          // Rarity border PNG if hasEffect
          if (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1) {
            const isOldSevenKnights = hero.group && hero.group.includes("(êµ¬)ì„¸ë¸ë‚˜ì´ì¸ ");
            const borderImg = document.createElement("img");
            borderImg.className = "rarity-border";
            borderImg.src = isOldSevenKnights
              ? "/images/border-legendary-oldsena.png"
              : "/images/border-legendary.png";
            borderImg.alt = "ì „ì„¤ í…Œë‘ë¦¬";
            item.appendChild(borderImg);
          }

          // ì˜ì›… ì´ë¦„ ì¶”ê°€
          const nameLabel = document.createElement('div');
          nameLabel.className = 'carousel-name';
          nameLabel.textContent = hero.name;
          item.appendChild(nameLabel);

          // í´ë¦­ ì´ë²¤íŠ¸
          item.addEventListener('click', () => {
            window.location.href = `/hero.html?name=${encodeURIComponent(hero.name)}`;
          });

          carousel.appendChild(item);
        });

        // í˜„ì¬ ì˜ì›…ìœ¼ë¡œ ìŠ¤í¬ë¡¤
        if (currentHeroIndex !== -1) {
          const activeItem = carousel.querySelector('.carousel-item.active');
          if (activeItem) {
            setTimeout(() => {
              activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
            }, 100);
          }
        }

        // ìºëŸ¬ì…€ í™”ì‚´í‘œ ë²„íŠ¼ ê¸°ëŠ¥
        const prevBtn = document.getElementById('carousel-prev');
        const nextBtn = document.getElementById('carousel-next');

        if (prevBtn && nextBtn) {
          // ì´ì „ ë²„íŠ¼ í´ë¦­
          prevBtn.addEventListener('click', () => {
            const scrollAmount = 300;
            carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
          });

          // ë‹¤ìŒ ë²„íŠ¼ í´ë¦­
          nextBtn.addEventListener('click', () => {
            const scrollAmount = 300;
            carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
          });

          // ìŠ¤í¬ë¡¤ ìœ„ì¹˜ì— ë”°ë¼ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
          function updateButtonStates() {
            const isAtStart = carousel.scrollLeft <= 0;
            const isAtEnd = carousel.scrollLeft >= carousel.scrollWidth - carousel.clientWidth - 10;

            prevBtn.disabled = isAtStart;
            nextBtn.disabled = isAtEnd;
          }

          // ì´ˆê¸° ìƒíƒœ ì„¤ì •
          updateButtonStates();

          // ìŠ¤í¬ë¡¤ ì‹œ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
          carousel.addEventListener('scroll', updateButtonStates);
        }
      })
      .catch(err => console.error('âŒ ì˜ì›… ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', err));

    // âœ… ê´€ë ¨ ì˜ì›… ë Œë”ë§ í•¨ìˆ˜ (ë‚´ë¶€ ë§í¬ ê°•í™”)
    function renderRelatedHeroes(currentHero) {
      const grid = document.getElementById('related-heroes-grid');
      if (!grid || !allHeroes || allHeroes.length === 0) return;

      // ê°™ì€ íƒ€ì… ë˜ëŠ” ê°™ì€ ê·¸ë£¹ì˜ ì˜ì›…ì„ ì°¾ê¸° (í˜„ì¬ ì˜ì›… ì œì™¸)
      const related = allHeroes.filter(h =>
        h.name !== currentHero.name &&
        (h.type === currentHero.type || h.group === currentHero.group)
      ).slice(0, 5);

      // 5ê°œê°€ ì•ˆ ë˜ë©´ ëœë¤ìœ¼ë¡œ ì±„ìš°ê¸°
      if (related.length < 5) {
        const remaining = allHeroes.filter(h =>
          h.name !== currentHero.name && !related.includes(h)
        );
        while (related.length < 5 && remaining.length > 0) {
          const randomIndex = Math.floor(Math.random() * remaining.length);
          related.push(remaining.splice(randomIndex, 1)[0]);
        }
      }

      // ë Œë”ë§
      grid.innerHTML = related.map(hero => {
        const rarityClass = (() => {
          switch (hero.rarity) {
            case "ì „ì„¤+": return "legendary-plus";
            case "ì „ì„¤": return "legendary";
            case "í¬ê·€": return "rare";
            case "ê³ ê¸‰": return "uncommon";
            default: return "normal";
          }
        })();

        const hasEffectClass = (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1) ? 'has-effect' : '';
        const isOldSevenKnights = hero.group && hero.group.includes("(êµ¬)ì„¸ë¸ë‚˜ì´ì¸ ");
        const borderImage = (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1)
          ? (isOldSevenKnights ? "/images/border-legendary-oldsena.png" : "/images/border-legendary.png")
          : '';

        return `
          <a href="/hero.html?name=${encodeURIComponent(hero.name)}" class="related-hero-card">
            <div class="related-hero-portrait-wrap">
              <img src="${hero.portrait || ''}" alt="${hero.name} ì´ˆìƒí™”" class="related-hero-portrait rarity-${rarityClass} ${hasEffectClass}" loading="lazy" />
              ${borderImage ? `<img src="${borderImage}" alt="ì „ì„¤ í…Œë‘ë¦¬" class="rarity-border" loading="lazy" />` : ''}
              ${hero.typeImage ? `<img src="${hero.typeImage}" alt="${hero.type}" class="hero-type-badge" loading="lazy" />` : ''}
            </div>
            <div class="related-hero-info">
              <h3 class="related-hero-name">${hero.name}</h3>
              <div class="related-hero-meta">
                <span class="hero-type ${getTypeClass(hero.type)}">${hero.type || ''}</span>
                <span class="hero-rarity ${getRarityClass(hero.rarity)}">${hero.rarity || ''}</span>
              </div>
            </div>
          </a>
        `;
      }).join('');
    }

    function getTypeClass(type) {
      const map = {
        "ê³µê²©í˜•": "type-attack",
        "ë§ˆë²•í˜•": "type-magic",
        "ì§€ì›í˜•": "type-support",
        "ë§ŒëŠ¥í˜•": "type-versatile",
        "ë°©ì–´í˜•": "type-defense"
      };
      return map[type] || '';
    }

    function getRarityClass(rarity) {
      const map = {
        "ì „ì„¤+": "rarity-legendary-plus",
        "ì „ì„¤": "rarity-legendary",
        "í¬ê·€": "rarity-rare"
      };
      return map[rarity] || '';
    }
  </script>

  <script>
    // íƒ­ ì „í™˜ ê¸°ëŠ¥
    document.addEventListener('DOMContentLoaded', () => {
      const tabBtns = document.querySelectorAll('.tab-btn');
      const tabContents = document.querySelectorAll('.tab-content');

      tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          const targetTab = btn.getAttribute('data-tab');

          // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ ì»¨í…ì¸ ì—ì„œ active ì œê±°
          tabBtns.forEach(b => b.classList.remove('active'));
          tabContents.forEach(content => content.classList.remove('active'));

          // í´ë¦­ëœ íƒ­ í™œì„±í™”
          btn.classList.add('active');
          document.getElementById(`tab-${targetTab}`).classList.add('active');
        });
      });
    });
  </script>

  <script>
    // í…Œë§ˆ í† ê¸€ ê¸°ëŠ¥
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    const themeText = document.getElementById('theme-text');
    const htmlElement = document.documentElement;

    // ì €ì¥ëœ í…Œë§ˆ ë˜ëŠ” ì‹œìŠ¤í…œ ê¸°ë³¸ê°’ ê°€ì ¸ì˜¤ê¸°
    function getInitialTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        return savedTheme;
      }
      // ì‹œìŠ¤í…œ ë‹¤í¬ ëª¨ë“œ ì„¤ì • í™•ì¸
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      return prefersDark ? 'dark' : 'light';
    }

    // í…Œë§ˆ ì ìš©
    function applyTheme(theme) {
      if (theme === 'light') {
        htmlElement.setAttribute('data-theme', 'light');
        if (themeIcon) themeIcon.className = 'ph-bold ph-moon';
        if (themeText) themeText.textContent = 'ë‹¤í¬ ëª¨ë“œ';
      } else {
        htmlElement.removeAttribute('data-theme');
        if (themeIcon) themeIcon.className = 'ph-bold ph-sun';
        if (themeText) themeText.textContent = 'ë¼ì´íŠ¸ ëª¨ë“œ';
      }
      localStorage.setItem('theme', theme);
    }

    // í…Œë§ˆ ì „í™˜
    function toggleTheme() {
      const currentTheme = htmlElement.getAttribute('data-theme') === 'light' ? 'light' : 'dark';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      applyTheme(newTheme);
    }

    // ì´ˆê¸° í…Œë§ˆ ì ìš©
    applyTheme(getInitialTheme());

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    if (themeToggle) {
      themeToggle.addEventListener('click', toggleTheme);
    }

    // ì‹œìŠ¤í…œ í…Œë§ˆ ë³€ê²½ ê°ì§€ (ì„ íƒì‚¬í•­)
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      if (!localStorage.getItem('theme')) {
        applyTheme(e.matches ? 'dark' : 'light');
      }
    });
  </script>

  <!-- Header, Mobile Menu, Theme Scripts -->
  <script src="/js/global-protection.js"></script>
  <script src="/js/header.js"></script>
  <script src="/js/theme.js"></script>
  <script src="/js/mobile-menu.js"></script>
    </main>
  </div>
</body>
</html>