<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>영웅 상세 - 세븐나이츠 리버스 도감</title>
  <meta name="description" content="세븐나이츠 리버스 영웅 상세 페이지" />
  <link rel="stylesheet" href="./style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2"></script>
</head>
<body class="hero-detail-page">
  <header class="hero-header">
    <button class="back-button" onclick="window.history.back()"><i class="ph-bold ph-caret-left"></i> 목록으로</button>
  </header>

  <main class="hero-detail-container">
    <section class="hero-top">
      <div class="hero-portrait-wrap">
        <img id="hero-portrait" class="hero-detail-portrait" alt="영웅 초상화" />
      </div>
      <div class="hero-basic-info">
        <h1 id="hero-name" class="hero-name"></h1>
        <p id="hero-nickname" class="hero-nickname"></p>
        <p id="hero-group" class="hero-group"></p>
        <div class="hero-meta">
          <span id="hero-type" class="hero-type"></span>
          <span id="hero-rarity" class="hero-rarity"></span>
        </div>
      </div>
    </section>

    <section class="hero-stats">
      <h2>스탯</h2>
      <table class="stats-table">
        <tr><td>공격력</td><td id="atk"></td></tr>
        <tr><td>방어력</td><td id="def"></td></tr>
        <tr><td>생명력</td><td id="hp"></td></tr>
        <tr><td>속공</td><td id="spd"></td></tr>
        <tr><td>치명타 확률(%)</td><td id="crit_rate"></td></tr>
        <tr><td>치명타 피해(%)</td><td id="crit_dmg"></td></tr>
        <tr><td>약점 공격 확률(%)</td><td id="weak_rate"></td></tr>
        <tr><td>막기 확률(%)</td><td id="block_rate"></td></tr>
        <tr><td>받는 피해 감소(%)</td><td id="dmg_reduce"></td></tr>
        <tr><td>효과 적중(%)</td><td id="eff_hit"></td></tr>
        <tr><td>효과 저항(%)</td><td id="eff_res"></td></tr>
      </table>
    </section>

    <section class="hero-skills">
      <h2>스킬</h2>
      <div class="skill attack-skill">
        <h3>기본 공격</h3>
        <img id="attack-image" alt="공격 이미지" />
        <p><strong id="attack-name" class="skill-name"></strong> <span id="attack-cooltime" class="skill-cooltime"></span></p>
        <p id="attack-desc" class="skill-desc"></p>
      </div>
      <div class="skill active-skill-1">
        <h3>액티브 스킬 1</h3>
        <img id="active-1-image" alt="액티브 스킬 1 이미지" />
        <p><strong id="active-1-name" class="skill-name"></strong> <span id="active-1-cooltime" class="skill-cooltime"></span></p>
        <p id="active-1-desc" class="skill-desc"></p>
      </div>
      <div class="skill active-skill-2">
        <h3>액티브 스킬 2</h3>
        <img id="active-2-image" alt="액티브 스킬 2 이미지" />
        <p><strong id="active-2-name" class="skill-name"></strong> <span id="active-2-cooltime" class="skill-cooltime"></span></p>
        <p id="active-2-desc" class="skill-desc"></p>
      </div>
      <div class="skill passive-skill">
        <h3>패시브</h3>
        <img id="passive-image" alt="패시브 이미지" />
        <p><strong id="passive-name" class="skill-name"></strong> <span id="passive-cooltime" class="skill-cooltime"></span></p>
        <p id="passive-desc" class="skill-desc"></p>
      </div>
    </section>

    <section class="hero-description">
      <h2>설명</h2>
      <p id="hero-description"></p>
    </section>
  </main>

  <script>
    const params = new URLSearchParams(window.location.search);
    const heroId = params.get("id");

    if (!heroId) {
      document.querySelector("main").innerHTML = "<p>유효하지 않은 영웅 ID입니다.</p>";
    } else {
      fetch(`/api/hero/${heroId}`)
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(hero => {
          if (!hero || !hero.name) {
            document.querySelector("main").innerHTML = "<p>영웅 정보를 불러올 수 없습니다.</p>";
            return;
          }

          document.title = `${hero.name} - 세븐나이츠 리버스 도감`;
          document.querySelector('meta[name="description"]').setAttribute("content", `${hero.name}의 상세 정보를 확인하세요.`);

          // 기본 정보
          document.getElementById("hero-portrait").src = hero.portrait || "";
          // 다이아몬드 반짝 효과 (체크박스 필드 기반)
          if (hero.hasEffect) {
            const portraitWrap = document.querySelector(".hero-portrait-wrap");
            if (portraitWrap) {
              const diamond = document.createElement("div");
              diamond.className = "rarity-diamond-effect";
              portraitWrap.appendChild(diamond);
            }
          }
          // 희귀도별 배경색 클래스 적용
          const portraitEl = document.getElementById("hero-portrait");
          if (portraitEl) {
            const rarityClass = (() => {
              switch (hero.rarity) {
                case "전설+": return "legendary-plus";
                case "전설": return "legendary";
                case "희귀": return "rare";
                case "고급": return "uncommon";
                default: return "normal";
              }
            })();
            portraitEl.classList.add(`rarity-${rarityClass}`);
          }
          // hasEffect가 true면 초상화에 빛나는 테두리 클래스 부여
          if (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1) {
            const portraitEl = document.getElementById("hero-portrait");
            if (portraitEl) {
              portraitEl.classList.add("has-effect");
            }
          }
          document.getElementById("hero-name").textContent = hero.name || "";
          document.getElementById("hero-nickname").textContent = hero.nickname || "";
          document.getElementById("hero-group").textContent = hero.group || "";
          document.getElementById("hero-type").textContent = hero.type || "";
          document.getElementById("hero-rarity").textContent = hero.rarity || "";

          // 스탯
          const statFields = ["atk","def","hp","spd","crit_rate","crit_dmg","weak_rate","block_rate","dmg_reduce","eff_hit","eff_res"];
          statFields.forEach(field => {
            document.getElementById(field).textContent = hero[field] || "-";
          });

          // 스킬 출력 함수
          const renderSkill = (prefix, skill) => {
            document.getElementById(`${prefix}-image`).src = skill?.image || "";
            document.getElementById(`${prefix}-name`).textContent = skill?.name || "";
            document.getElementById(`${prefix}-cooltime`).textContent = skill?.cooltime ? `쿨타임: ${skill.cooltime}` : "";
            document.getElementById(`${prefix}-desc`).textContent = skill?.desc || "";
          };

          renderSkill("attack", hero.attack);
          renderSkill("active-1", hero.active_1);
          renderSkill("active-2", hero.active_2);
          renderSkill("passive", hero.passive);

          document.getElementById("hero-description").textContent = hero.description || "";
        })
        .catch(err => {
          console.error("Hero fetch error:", err);
          document.querySelector("main").innerHTML = "<p>데이터를 불러오는 중 오류가 발생했습니다.</p>";
        });
    }
  </script>
</body>
</html>