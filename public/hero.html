<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="dynamic-title">ì˜ì›… ìƒì„¸ - ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ê°€ì´ë“œë¶</title>
  <!-- SEO Meta Tags for Hero Detail Page -->
  <meta id="meta-description" name="description" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›… ìƒì„¸ í˜ì´ì§€" />
  <meta id="meta-keywords" name="keywords" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤, ì˜ì›…, ìƒì„¸, ë„ê°, Seven Knights, Hero, Detail" />
  <meta name="author" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ê°€ì´ë“œë¶" />
  <!-- Open Graph Meta Tags -->
  <meta property="og:site_name" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ê°€ì´ë“œë¶" />
  <meta id="og-title" property="og:title" content="ì˜ì›… ìƒì„¸ - ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ê°€ì´ë“œë¶" />
  <meta id="og-description" property="og:description" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›…ì˜ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”." />
  <meta id="og-image" property="og:image" content="/default-hero-og-image.png" />
  <meta id="og-url" property="og:url" content="https://sena-rebirth-guidebook.app/hero.html" />
  <meta property="og:type" content="article" />
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta id="twitter-title" name="twitter:title" content="ì˜ì›… ìƒì„¸ - ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ê°€ì´ë“œë¶" />
  <meta id="twitter-description" name="twitter:description" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›…ì˜ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”." />
  <meta id="twitter-image" name="twitter:image" content="/default-hero-og-image.png" />
  <!-- Canonical Link -->
  <link id="canonical-link" rel="canonical" href="https://sena-rebirth-guidebook.app/hero.html" />
  <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="googlebot" content="index, follow">
  <meta name="naverbot" content="index, follow">
  <meta name="subject" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›… ìƒì„¸ ì •ë³´, ìŠ¤í‚¬, ëŠ¥ë ¥ì¹˜, ì†Œì†">
  <meta name="rating" content="general">
  <meta name="distribution" content="global">
  <meta name="theme-color" content="#181818">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7293515082092840"
     crossorigin="anonymous"></script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "VideoGameCharacter",
  "name": "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›…",
  "url": "https://sena-rebirth-guidebook.app/hero.html",
  "description": "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›…ì˜ ìŠ¤íƒ¯, ìŠ¤í‚¬, ì†Œì† ë° í¬ê·€ë„ ìƒì„¸ ì •ë³´ í˜ì´ì§€ì…ë‹ˆë‹¤.",
  "inLanguage": "ko",
  "isPartOf": {
    "@type": "VideoGame",
    "name": "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ (Seven Knights Re:birth)"
  }
}
</script>
  <link rel="stylesheet" href="./style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2"></script>
  <!-- Google tag (gtag.js) - Only on production -->
  <script>
    // Only load analytics on production domain and not in developer mode
    // To enable developer mode (exclude your traffic):
    //   Console: localStorage.setItem('devMode', 'true')
    // To disable developer mode:
    //   Console: localStorage.removeItem('devMode')
    var isProduction = window.location.hostname === 'sena-rebirth-guidebook.app';
    var isDeveloperMode = localStorage.getItem('devMode') === 'true';

    if (isProduction && !isDeveloperMode) {
      // Load gtag.js
      var gtagScript = document.createElement('script');
      gtagScript.async = true;
      gtagScript.src = 'https://www.googletagmanager.com/gtag/js?id=G-DMD8LXSEQ5';
      document.head.appendChild(gtagScript);

      // Initialize GA with hero-specific tracking
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      // Dynamically extract hero name for analytics
      const analyticsParams = new URLSearchParams(window.location.search);
      const heroNameForAnalytics = analyticsParams.get("name") || "unknown";
      gtag('config', 'G-DMD8LXSEQ5', {
        'page_title': `Hero Detail - ${heroNameForAnalytics}`,
        'page_path': `/hero/${encodeURIComponent(heroNameForAnalytics)}`
      });
    } else if (isDeveloperMode) {
      console.log('Developer mode enabled - Analytics disabled');
    }
  </script>
</head>
<body>
  <script>
    // ì „ì—­ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•œ heroId
    const globalParams = new URLSearchParams(window.location.search);
    window.heroId = globalParams.get("name") ? decodeURIComponent(globalParams.get("name")) : null;
  </script>
  <header class="hero-header">
    <div class="hero-nav-buttons">
      <button class="back-button" onclick="window.history.back()"><i class="ph-bold ph-caret-left"></i> ëª©ë¡ìœ¼ë¡œ</button>
    </div>
    <div class="header-actions">
      <button class="theme-toggle" id="theme-toggle" aria-label="í…Œë§ˆ ì „í™˜">
        <i class="ph-bold ph-sun" id="theme-icon"></i>
        <span id="theme-text">ë¼ì´íŠ¸ ëª¨ë“œ</span>
      </button>
    </div>
  </header>

  <div class="hero-detail-page">
    <main class="hero-detail-container">
      <div id="hero-skeleton" class="skeleton-container">
        <div class="skeleton hero-portrait-skeleton"></div>
        <div class="skeleton hero-name-skeleton"></div>
        <div class="skeleton hero-meta-skeleton"></div>
        <div class="skeleton skill-skeleton"></div>
        <div class="skeleton skill-skeleton"></div>
        <div class="skeleton skill-skeleton"></div>
      </div>
    <!-- Page Header (Hidden for visual, visible for SEO & Screen Readers) -->
    <div class="page-header sr-only">
      <h1 id="hero-guide-heading">ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›… ìƒì„¸ ì •ë³´</h1>
      <p class="subtitle">ì˜ì›…ì˜ ìŠ¤íƒ¯, ìŠ¤í‚¬, í¬ê·€ë„ ë° ì†Œì†ì„ ìì„¸íˆ í™•ì¸í•˜ì„¸ìš”.</p>
    </div>
    <section class="hero-top">
      <!-- ì´ì „ ì˜ì›… ë„¤ë¹„ê²Œì´ì…˜ -->
      <button class="hero-nav-side prev-hero-side" id="prev-hero-side" aria-label="ì´ì „ ì˜ì›…" title="ì´ì „ ì˜ì›…">
        <i class="ph-bold ph-caret-left nav-arrow"></i>
        <div class="nav-hero-info">
          <img class="nav-hero-portrait" id="prev-hero-portrait" alt="" />
          <span class="nav-hero-name" id="prev-hero-name"></span>
        </div>
      </button>

      <div class="hero-center-content">
        <div class="hero-portrait-wrap">
          <img id="hero-portrait" class="hero-portrait" alt="ì˜ì›… ì´ˆìƒí™”" />
        </div>

        <div class="hero-basic-info">
          <h2 id="hero-name" class="hero-name"></h2>
          <p id="hero-nickname" class="hero-nickname"></p>
          <p id="hero-group" class="hero-group"></p>
          <div class="hero-meta">
            <span id="hero-type" class="hero-type"></span>
            <span id="hero-rarity" class="hero-rarity"></span>
          </div>
        </div>
      </div>

      <!-- ë‹¤ìŒ ì˜ì›… ë„¤ë¹„ê²Œì´ì…˜ -->
      <button class="hero-nav-side next-hero-side" id="next-hero-side" aria-label="ë‹¤ìŒ ì˜ì›…" title="ë‹¤ìŒ ì˜ì›…">
        <div class="nav-hero-info">
          <img class="nav-hero-portrait" id="next-hero-portrait" alt="" />
          <span class="nav-hero-name" id="next-hero-name"></span>
        </div>
        <i class="ph-bold ph-caret-right nav-arrow"></i>
      </button>
    </section>

    <section class="hero-stats">
      <h2>ìŠ¤íƒ¯</h2>
      <p class="stats-info">30ë ˆë²¨ 5ê°•í™” 0ì´ˆì›” ê¸°ì¤€ì…ë‹ˆë‹¤</p>
      <table class="stats-table">
        <tr><td>ê³µê²©ë ¥</td><td id="atk"></td></tr>
        <tr><td>ë°©ì–´ë ¥</td><td id="def"></td></tr>
        <tr><td>ìƒëª…ë ¥</td><td id="hp"></td></tr>
        <tr><td>ì†ê³µ</td><td id="spd"></td></tr>
        <tr><td>ì¹˜ëª…íƒ€ í™•ë¥ (%)</td><td id="crit_rate"></td></tr>
        <tr><td>ì¹˜ëª…íƒ€ í”¼í•´(%)</td><td id="crit_dmg"></td></tr>
        <tr><td>ì•½ì  ê³µê²© í™•ë¥ (%)</td><td id="weak_rate"></td></tr>
        <tr><td>ë§‰ê¸° í™•ë¥ (%)</td><td id="block_rate"></td></tr>
        <tr><td>ë°›ëŠ” í”¼í•´ ê°ì†Œ(%)</td><td id="dmg_reduce"></td></tr>
        <tr><td>íš¨ê³¼ ì ì¤‘(%)</td><td id="eff_hit"></td></tr>
        <tr><td>íš¨ê³¼ ì €í•­(%)</td><td id="eff_res"></td></tr>
      </table>
    </section>

    <section class="hero-skills">
      <h2>ìŠ¤í‚¬</h2>
      <div class="skill attack-skill">
        <h3>ê¸°ë³¸ ê³µê²©</h3>
        <img id="attack-image" alt="ê³µê²© ì´ë¯¸ì§€" />
        <p><strong id="attack-name" class="skill-name"></strong> <span id="attack-cooltime" class="skill-cooltime"></span></p>
        <p id="attack-desc" class="skill-desc"></p>
      </div>
      <div class="skill active-skill-1">
        <h3>ì•¡í‹°ë¸Œ ìŠ¤í‚¬ 1</h3>
        <img id="active-1-image" alt="ì•¡í‹°ë¸Œ ìŠ¤í‚¬ 1 ì´ë¯¸ì§€" />
        <p><strong id="active-1-name" class="skill-name"></strong> <span id="active-1-cooltime" class="skill-cooltime"></span></p>
        <p id="active-1-desc" class="skill-desc"></p>
      </div>
      <div class="skill active-skill-2">
        <h3>ì•¡í‹°ë¸Œ ìŠ¤í‚¬ 2</h3>
        <img id="active-2-image" alt="ì•¡í‹°ë¸Œ ìŠ¤í‚¬ 2 ì´ë¯¸ì§€" />
        <p><strong id="active-2-name" class="skill-name"></strong> <span id="active-2-cooltime" class="skill-cooltime"></span></p>
        <p id="active-2-desc" class="skill-desc"></p>
      </div>
      <div class="skill passive-skill">
        <h3>íŒ¨ì‹œë¸Œ</h3>
        <img id="passive-image" alt="íŒ¨ì‹œë¸Œ ì´ë¯¸ì§€" />
        <p><strong id="passive-name" class="skill-name"></strong> <span id="passive-cooltime" class="skill-cooltime"></span></p>
        <p id="passive-desc" class="skill-desc"></p>
      </div>
    </section>
    </main>

    <section class="hero-comments">
      <h2>ì˜ê²¬ ë‚¨ê¸°ê¸°</h2>
      <form id="comment-form">
        <input type="text" id="nickname" name="nickname" placeholder="ë‹‰ë„¤ì„" required />
        <textarea id="comment-content" name="content" placeholder="ì˜ê²¬ì„ ì…ë ¥í•˜ì„¸ìš”..." required></textarea>
        <button type="submit">ë“±ë¡</button>
      </form>
      <ul id="comment-list" class="comment-list"></ul>
    </section>
  </div>

  <script>
    const heroName = window.heroId;
    const heroId = heroName ? heroName : null;

    if (!heroId) {
      document.querySelector("main").innerHTML = "<p>ìœ íš¨í•˜ì§€ ì•Šì€ ì˜ì›… IDì…ë‹ˆë‹¤.</p>";
    } else {
      const skeleton = document.getElementById("hero-skeleton");
      const container = document.querySelector(".hero-detail-container");
      if (container && skeleton) {
        container.classList.add("loading");
        skeleton.style.display = "block";
      }
      fetch(`/api/hero/name/${encodeURIComponent(heroId)}`)
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return res.json();
        })
        .then(hero => {
          if (container && skeleton) {
            container.classList.remove("loading");
            skeleton.style.display = "none";
          }
          if (!hero || !hero.name) {
            document.querySelector("main").innerHTML = "<p>ì˜ì›… ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
          }

          // === (êµ¬)ì„¸ë¸ë‚˜ì´ì¸  ì „ìš© data-group ì†ì„± ì¶”ê°€ ===
          if (hero.group) {
            const pageContainer = document.querySelector(".hero-detail-page");
            if (pageContainer) {
              pageContainer.setAttribute("data-group", hero.group);
              if (hero.group.includes("(êµ¬)ì„¸ë¸ë‚˜ì´ì¸ ")) {
                pageContainer.classList.add("old-sevenknights");
                console.log(`ğŸ’œ (êµ¬)ì„¸ë¸ë‚˜ì´ì¸  ê·¸ë£¹ ê°ì§€ë¨ â†’ ${hero.name}`);
              } else {
                console.log(`ğŸ’› ì¼ë°˜ ê·¸ë£¹ â†’ ${hero.name}`);
              }
            }
          }

          // Update SEO meta tags dynamically
          const heroTitle = `${hero.name} (${hero.rarity} / ${hero.type}) - ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ê°€ì´ë“œë¶`;
          document.title = heroTitle;
          const titleEl = document.getElementById("dynamic-title");
          if (titleEl) titleEl.textContent = heroTitle;

          // í’ë¶€í•˜ê³  ê°€ì´ë“œ ìŠ¤íƒ€ì¼ì˜ ì„¤ëª… ë° í‚¤ì›Œë“œ
          const groupText = hero.group || "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤";
          const guideDesc = `ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ${hero.name} ì™„ë²½ ê³µëµ: ìŠ¤í‚¬, ì„±ëŠ¥, ì¥ë¹„, ì¶”ì²œ ì„¸íŒ…, í™œìš©ë²•ê¹Œì§€ ì´ì •ë¦¬! ${groupText} ì†Œì† ${hero.rarity} ë“±ê¸‰ ${hero.type} ì˜ì›…ì˜ ìŠ¤íƒ¯, ìŠ¤í‚¬ ì •ë³´, ì¥ì ê³¼ ë‹¨ì , íŒŒí‹° ì¡°í•©, ì¶”ì²œ ì¥ë¹„, ì„±ì¥ íŒ, PvE/PvP í™œìš©ë²• ë“± ëª¨ë“  ì •ë³´ë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.`;
          const desc = guideDesc;
          const url = `${location.origin}${location.pathname}?id=${encodeURIComponent(heroId)}`;

          // <h1> ì—…ë°ì´íŠ¸
          const heading = document.getElementById("hero-guide-heading");
          if (heading) heading.textContent = `ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ${hero.name} ì™„ë²½ ê³µëµ: ìŠ¤í‚¬, ì„±ëŠ¥, ì¥ë¹„ ì´ì •ë¦¬`;

          // Description
          const descMeta = document.getElementById("meta-description");
          if (descMeta) descMeta.setAttribute("content", desc);

          // Keywords: ì˜ì›…ëª…, ì†Œì†, íƒ€ì…, í¬ê·€ë„, ê°€ì´ë“œ/ê³µëµ ê´€ë ¨ ê²€ìƒ‰ì–´ í¬í•¨
          const keywordsMeta = document.getElementById("meta-keywords");
          if (keywordsMeta) {
            const keywordsArr = [
              "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤", "Seven Knights Re:birth", "ì˜ì›…", "ìƒì„¸", "ë„ê°", "ê³µëµ", "ê°€ì´ë“œ", "ìŠ¤í‚¬", "ì„±ëŠ¥", "ì¥ë¹„", "ì¶”ì²œ", "ì„¸íŒ…", "ì¡°í•©", "ì„±ì¥", "íŒ", "PVP", "PVE", "íŒŒí‹°", "í™œìš©ë²•",
              hero.name, hero.nickname, groupText, hero.type, hero.rarity
            ];
            // Remove duplicates and falsy
            const keywords = Array.from(new Set(keywordsArr.filter(Boolean))).join(", ");
            keywordsMeta.setAttribute("content", keywords);
          }

          // Open Graph
          const ogTitle = document.getElementById("og-title");
          if (ogTitle) ogTitle.setAttribute("content", heroTitle);
          const ogDescEl = document.getElementById("og-description");
          if (ogDescEl) ogDescEl.setAttribute("content", desc);
          const ogImage = document.getElementById("og-image");
          if (ogImage) ogImage.setAttribute("content", hero.portrait || "/default-hero-og-image.png");
          const ogUrl = document.getElementById("og-url");
          if (ogUrl) ogUrl.setAttribute("content", url);

          // Twitter Card
          const twTitle = document.getElementById("twitter-title");
          if (twTitle) twTitle.setAttribute("content", heroTitle);
          const twDesc = document.getElementById("twitter-description");
          if (twDesc) twDesc.setAttribute("content", desc);
          const twImage = document.getElementById("twitter-image");
          if (twImage) twImage.setAttribute("content", hero.portrait || "/default-hero-og-image.png");

          // Canonical
          const canonical = document.getElementById("canonical-link");
          if (canonical) canonical.setAttribute("href", url);

          // âœ… êµ¬ì¡°í™” ë°ì´í„°(JSON-LD) ë™ì  ìƒì„± (VideoGameCharacter + Article)
          const keywordsArr = [
            "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤", "Seven Knights Re:birth", "ì˜ì›…", "ìƒì„¸", "ë„ê°", "ê³µëµ", "ê°€ì´ë“œ", "ìŠ¤í‚¬", "ì„±ëŠ¥", "ì¥ë¹„", "ì¶”ì²œ", "ì„¸íŒ…", "ì¡°í•©", "ì„±ì¥", "íŒ", "PVP", "PVE", "íŒŒí‹°", "í™œìš©ë²•",
            hero.name, hero.nickname, groupText, hero.type, hero.rarity
          ];
          const jsonLdObj = [
            {
              "@context": "https://schema.org",
              "@type": "VideoGameCharacter",
              "name": hero.name,
              "alternateName": hero.nickname || undefined,
              "description": desc,
              "image": hero.portrait || "/default-hero-og-image.png",
              "url": url,
              "inLanguage": "ko",
              "rarity": hero.rarity,
              "characterAttribute": hero.type,
              "memberOf": groupText,
              "isPartOf": {
                "@type": "VideoGame",
                "name": "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ (Seven Knights Re:birth)"
              }
            },
            {
              "@context": "https://schema.org",
              "@type": "Article",
              "headline": `ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ${hero.name} ì™„ë²½ ê³µëµ: ìŠ¤í‚¬, ì„±ëŠ¥, ì¥ë¹„ ì´ì •ë¦¬`,
              "articleSection": "ì˜ì›… ê°€ì´ë“œ, ìƒì„¸ ì •ë³´, ìŠ¤í‚¬/ì„±ëŠ¥/ì¥ë¹„ ë¶„ì„",
              "about": hero.name,
              "author": { "@type": "Organization", "name": "ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ê°€ì´ë“œë¶" },
              "inLanguage": "ko",
              "image": hero.portrait || "/default-hero-og-image.png",
              "datePublished": hero.datePublished || undefined,
              "dateModified": hero.dateModified || undefined,
              "mainEntityOfPage": url,
              "keywords": Array.from(new Set(keywordsArr.filter(Boolean))).join(", "),
              "description": desc,
              "url": url
            }
          ];
          const jsonLdEl = document.querySelector('script[type="application/ld+json"]');
          if (jsonLdEl) {
            jsonLdEl.textContent = JSON.stringify(jsonLdObj, null, 2);
          }

          // === Hero portrait area rendering (index.html card logic adapted) ===
          (function renderHeroPortrait() {
            // Remove existing children
            const wrap = document.querySelector(".hero-portrait-wrap");
            if (!wrap) return;
            wrap.innerHTML = "";
            wrap.style.position = "relative";

            // Determine rarityClass (for border/background)
            const rarityClass = (() => {
              switch (hero.rarity) {
                case "ì „ì„¤+": return "legendary-plus";
                case "ì „ì„¤": return "legendary";
                case "í¬ê·€": return "rare";
                case "ê³ ê¸‰": return "uncommon";
                default: return "normal";
              }
            })();

            // Portrait img
            const img = document.createElement("img");
            img.className = `hero-portrait rarity-${rarityClass}`;
            img.alt = "ì˜ì›… ì´ˆìƒí™”";
            img.src = hero.portrait || "";
            // Add error handler for missing portraits
            img.onerror = function() {
              console.warn(`ì´ˆìƒí™” ë¡œë“œ ì‹¤íŒ¨: ${hero.name}`);
              this.style.display = 'none'; // Hide broken image
            };
            // Add shine border if hasEffect
            if (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1) {
              img.classList.add("has-effect");
            }
            wrap.appendChild(img);

            // Diamond/star SVG if hasEffect
            if (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1) {
              const isOldSevenKnights = hero.group && hero.group.includes("(êµ¬)ì„¸ë¸ë‚˜ì´ì¸ ");
              const gradientId = isOldSevenKnights
                ? `paint0_diamond_purple_${hero.name.replace(/\s/g, '')}_${hero.id}`
                : `paint0_diamond_gold_${hero.name.replace(/\s/g, '')}_${hero.id}`;

              const starWrapper = document.createElement("div");
              starWrapper.className = "rarity-diamond-effect";

              const gradientStops = isOldSevenKnights
                ? `
                  <stop stop-color="#EEDBFF"/>
                  <stop offset="0.5" stop-color="#C49CFF"/>
                  <stop offset="1" stop-color="#9C6BFF"/>
                `
                : `
                  <stop stop-color="#FFF8E1"/>
                  <stop offset="0.533654" stop-color="#FFE082"/>
                  <stop offset="1" stop-color="#FFB300"/>
                `;

              starWrapper.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 100" fill="none">
                  <defs>
                    <linearGradient id="${gradientId}" x1="0" y1="0" x2="500" y2="500" gradientUnits="userSpaceOnUse">
                      ${gradientStops}
                    </linearGradient>
                  </defs>
                  <path d="M99.0854 0.124826C99.6876 -0.259713 100.26 0.312411 99.8752 0.914611C74.5556 40.6083 73.1362 54.5342 90.8173 89.847C91.0858 90.3826 90.384 91.0844 89.8483 90.816L89.847 90.8174C54.5329 73.1375 40.6072 74.5546 0.914577 99.8752C0.312412 100.26 -0.259673 99.6876 0.124792 99.0854C25.4444 59.3918 26.8625 45.4671 9.18167 10.1521C8.9215 9.63314 9.57223 8.95807 10.1001 9.16059L10.1507 9.18308C45.4657 26.8639 59.3905 25.4457 99.0854 0.124826ZM65.703 34.2974C61.9959 35.3198 58.2999 36.037 54.5685 36.4171C48.0147 37.0846 41.7138 36.6839 35.4457 35.4467C36.6829 41.7148 37.0837 48.0156 36.4162 54.5693C36.0363 58.3003 35.3191 61.996 34.2969 65.7027C38.0036 64.6805 41.6993 63.9633 45.4303 63.5834C51.9843 62.9159 58.2853 63.3166 64.5537 64.5539C63.3165 58.2856 62.9157 51.9848 63.5833 45.4307C63.9634 41.6997 64.6808 38.0041 65.703 34.2974Z" fill="url(#${gradientId})"/>
                </svg>
              `;

              wrap.appendChild(starWrapper);
            }

            // Type badge (if hero.typeImage)
            if (hero.typeImage) {
              const badge = document.createElement("img");
              badge.className = "hero-type-badge";
              badge.src = hero.typeImage;
              badge.alt = hero.type || "íƒ€ì…";
              badge.style.position = "absolute";
              badge.style.left = "8px";
              badge.style.bottom = "8px";
              badge.style.width = "28px";
              badge.style.height = "28px";
              badge.style.zIndex = "2";
              wrap.appendChild(badge);
            }
          })();
          document.getElementById("hero-name").textContent = hero.name || "";
          document.getElementById("hero-nickname").textContent = hero.nickname || "";
          document.getElementById("hero-group").textContent = hero.group || "";

          // Set hero type with icon and color class
          const heroTypeEl = document.getElementById("hero-type");
          heroTypeEl.innerHTML = ""; // Clear previous content

          // Add type icon if available
          if (hero.typeImage) {
            const typeIcon = document.createElement("img");
            typeIcon.src = hero.typeImage;
            typeIcon.alt = hero.type || "íƒ€ì…";
            typeIcon.className = "hero-type-icon";
            typeIcon.style.width = "20px";
            typeIcon.style.height = "20px";
            typeIcon.style.marginRight = "6px";
            typeIcon.style.verticalAlign = "middle";
            heroTypeEl.appendChild(typeIcon);
          }

          // Add type text
          const typeText = document.createTextNode(hero.type || "");
          heroTypeEl.appendChild(typeText);

          const typeClassMap = {
            "ê³µê²©í˜•": "type-attack",
            "ë§ˆë²•í˜•": "type-magic",
            "ì§€ì›í˜•": "type-support",
            "ë§ŒëŠ¥í˜•": "type-versatile",
            "ë°©ì–´í˜•": "type-defense"
          };
          const typeClass = typeClassMap[hero.type];
          if (typeClass) {
            heroTypeEl.className = "hero-type " + typeClass;
          }

          // Set hero rarity with color class
          const heroRarityEl = document.getElementById("hero-rarity");
          heroRarityEl.textContent = hero.rarity || "";
          const rarityClassMap = {
            "ì „ì„¤+": "rarity-legendary-plus",
            "ì „ì„¤": "rarity-legendary",
            "í¬ê·€": "rarity-rare"
          };
          const rarityClass = rarityClassMap[hero.rarity];
          if (rarityClass) {
            heroRarityEl.className = "hero-rarity " + rarityClass;
          }

          // ìŠ¤íƒ¯
          const statFields = ["atk","def","hp","spd","crit_rate","crit_dmg","weak_rate","block_rate","dmg_reduce","eff_hit","eff_res"];
          statFields.forEach(field => {
            document.getElementById(field).textContent = hero[field] || "-";
          });

          // ìŠ¤í‚¬ ì¶œë ¥ í•¨ìˆ˜
          // Simple markdown parser for skill descriptions
          const parseMarkdown = (text) => {
            if (!text) return "";

            // Escape HTML first to prevent XSS
            let html = text
              .replace(/&/g, '&amp;')
              .replace(/</g, '&lt;')
              .replace(/>/g, '&gt;');

            // Parse markdown (in order of precedence)
            html = html
              // Bold: **text** or __text__
              .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
              .replace(/__(.+?)__/g, '<strong>$1</strong>')
              // Italic: *text* or _text_ (but not inside words)
              .replace(/(?<!\w)\*(.+?)\*(?!\w)/g, '<em>$1</em>')
              .replace(/(?<!\w)_(.+?)_(?!\w)/g, '<em>$1</em>')
              // Code: `text`
              .replace(/`(.+?)`/g, '<code>$1</code>')
              // Links: [text](url)
              .replace(/\[(.+?)\]\((.+?)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>')
              // Line breaks: \n -> <br>
              .replace(/\n/g, '<br>');

            // Wrap special effect boxes with colored backgrounds
            // Skill enhancement (ì²­ë¡ìƒ‰/cyan box)
            html = html.replace(/(\[ìŠ¤í‚¬ ê°•í™”\][^\[]*?)(?=\[|$|<br>)/g, '<span class="skill-box skill-enhancement">$1</span>');

            // Awakening effects (ìì£¼ìƒ‰/purple box) - 6ì´ˆì›”, 2ì´ˆì›”
            html = html.replace(/(\[6ì´ˆì›”\][^\[]*?)(?=\[|$|<br>)/g, '<span class="skill-box awakening-effect">$1</span>');
            html = html.replace(/(\[2ì´ˆì›”\][^\[]*?)(?=\[|$|<br>)/g, '<span class="skill-box awakening-effect">$1</span>');

            return html;
          };

          const renderSkill = (prefix, skill) => {
            document.getElementById(`${prefix}-image`).src = skill?.image || "";
            document.getElementById(`${prefix}-name`).textContent = skill?.name || "";
            document.getElementById(`${prefix}-cooltime`).textContent = skill?.cooltime ? `ì¿¨íƒ€ì„: ${skill.cooltime}` : "";
            document.getElementById(`${prefix}-desc`).innerHTML = parseMarkdown(skill?.desc || "");
          };

          renderSkill("attack", hero.attack);
          renderSkill("active-1", hero.active_1);
          renderSkill("active-2", hero.active_2);
          renderSkill("passive", hero.passive);

          const descEl = document.getElementById("hero-description");
          if (descEl) descEl.textContent = hero.description || "";

        })
        .catch(err => {
          if (container && skeleton) {
            container.classList.remove("loading");
            skeleton.style.display = "none";
          }
          console.error("Hero fetch error:", err);
          document.querySelector("main").innerHTML = "<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>";
        });
    }
</script>

  <script>
    const commentForm = document.getElementById("comment-form");
    const commentList = document.getElementById("comment-list");

    // ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadComments() {
      try {
        const res = await fetch(`/api/comments/${window.heroId}`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        commentList.innerHTML = "";
        (data.comments || []).forEach(comment => {
          const li = document.createElement("li");
          li.innerHTML = `<strong>${comment.nickname}</strong><p>${comment.content}</p><span>${comment.timestamp || ""}</span>`;
          commentList.appendChild(li);
        });
      } catch (err) {
        console.error("ëŒ“ê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:", err);
      }
    }

    // ëŒ“ê¸€ ë“±ë¡
commentForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const nickname = document.getElementById("nickname").value.trim();
  const content = document.getElementById("comment-content").value.trim();
  if (!nickname || !content) return alert("ë‹‰ë„¤ì„ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

  try {
    // âœ… [ì¶”ê°€ëœ ë¶€ë¶„] ì‹¤ì œë¡œ ì „ì†¡ë˜ëŠ” ë°ì´í„°ë¥¼ ì½˜ì†”ì— ì¶œë ¥
    console.log("ğŸ“© ì „ì†¡ ë°ì´í„°:", { heroId: window.heroId, nickname, content });

    const res = await fetch(`/api/comments/${window.heroId}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ heroId: window.heroId, nickname, content }),
    });

    // âœ… [ì¶”ê°€ëœ ë¶€ë¶„] ì„œë²„ ì‘ë‹µ ìƒíƒœ ì½”ë“œ í™•ì¸
    console.log("ğŸ“© ì„œë²„ ì‘ë‹µ ìƒíƒœ:", res.status);

    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    document.getElementById("comment-content").value = "";
    await loadComments();
  } catch (err) {
    console.error("âŒ ëŒ“ê¸€ ë“±ë¡ ì˜¤ë¥˜:", err);
    alert("ëŒ“ê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
  }
});

    // ì´ˆê¸° ë¡œë“œ
    loadComments();
  </script>

  <script>
    // ì˜ì›… ë„¤ë¹„ê²Œì´ì…˜ (ì´ì „/ë‹¤ìŒ ì˜ì›…)
    let allHeroes = [];
    let currentHeroIndex = -1;

    // ì „ì²´ ì˜ì›… ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    fetch('/api/heroes')
      .then(res => res.json())
      .then(heroes => {
        console.log('ğŸ“Š ì „ì²´ ì˜ì›… ëª©ë¡:', heroes.length, 'ëª…');
        allHeroes = heroes.sort((a, b) => a.name.localeCompare(b.name, 'ko'));
        currentHeroIndex = allHeroes.findIndex(h => h.name === heroName);
        console.log('ğŸ¯ í˜„ì¬ ì˜ì›…:', heroName, '/ ì¸ë±ìŠ¤:', currentHeroIndex);

        const prevButton = document.getElementById('prev-hero-side');
        const nextButton = document.getElementById('next-hero-side');
        const prevNameEl = document.getElementById('prev-hero-name');
        const nextNameEl = document.getElementById('next-hero-name');
        const prevPortraitEl = document.getElementById('prev-hero-portrait');
        const nextPortraitEl = document.getElementById('next-hero-portrait');

        console.log('ğŸ” ë²„íŠ¼ ìš”ì†Œ:', { prevButton, nextButton, prevNameEl, nextNameEl });

        if (currentHeroIndex > 0) {
          const prevHero = allHeroes[currentHeroIndex - 1];
          console.log('â¬…ï¸ ì´ì „ ì˜ì›…:', prevHero.name);
          prevButton.disabled = false;
          prevButton.style.display = 'flex';
          prevNameEl.textContent = prevHero.name;
          prevPortraitEl.src = prevHero.portrait;
          prevPortraitEl.alt = prevHero.name;
          prevButton.onclick = () => {
            window.location.href = `/hero.html?name=${encodeURIComponent(prevHero.name)}`;
          };
        } else {
          console.log('â¬…ï¸ ì´ì „ ì˜ì›… ì—†ìŒ (ì²« ë²ˆì§¸ ì˜ì›…)');
          prevButton.style.display = 'none';
        }

        if (currentHeroIndex < allHeroes.length - 1 && currentHeroIndex !== -1) {
          const nextHero = allHeroes[currentHeroIndex + 1];
          console.log('â¡ï¸ ë‹¤ìŒ ì˜ì›…:', nextHero.name);
          nextButton.disabled = false;
          nextButton.style.display = 'flex';
          nextNameEl.textContent = nextHero.name;
          nextPortraitEl.src = nextHero.portrait;
          nextPortraitEl.alt = nextHero.name;
          nextButton.onclick = () => {
            window.location.href = `/hero.html?name=${encodeURIComponent(nextHero.name)}`;
          };
        } else {
          console.log('â¡ï¸ ë‹¤ìŒ ì˜ì›… ì—†ìŒ (ë§ˆì§€ë§‰ ì˜ì›…)');
          nextButton.style.display = 'none';
        }
      })
      .catch(err => console.error('âŒ ì˜ì›… ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', err));
  </script>

  <script>
    // í…Œë§ˆ í† ê¸€ ê¸°ëŠ¥
    const themeToggle = document.getElementById('theme-toggle');
    const themeIcon = document.getElementById('theme-icon');
    const themeText = document.getElementById('theme-text');
    const htmlElement = document.documentElement;

    // ì €ì¥ëœ í…Œë§ˆ ë˜ëŠ” ì‹œìŠ¤í…œ ê¸°ë³¸ê°’ ê°€ì ¸ì˜¤ê¸°
    function getInitialTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme) {
        return savedTheme;
      }
      // ì‹œìŠ¤í…œ ë‹¤í¬ ëª¨ë“œ ì„¤ì • í™•ì¸
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      return prefersDark ? 'dark' : 'light';
    }

    // í…Œë§ˆ ì ìš©
    function applyTheme(theme) {
      if (theme === 'light') {
        htmlElement.setAttribute('data-theme', 'light');
        themeIcon.className = 'ph-bold ph-moon';
        themeText.textContent = 'ë‹¤í¬ ëª¨ë“œ';
      } else {
        htmlElement.removeAttribute('data-theme');
        themeIcon.className = 'ph-bold ph-sun';
        themeText.textContent = 'ë¼ì´íŠ¸ ëª¨ë“œ';
      }
      localStorage.setItem('theme', theme);
    }

    // í…Œë§ˆ ì „í™˜
    function toggleTheme() {
      const currentTheme = htmlElement.getAttribute('data-theme') === 'light' ? 'light' : 'dark';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      applyTheme(newTheme);
    }

    // ì´ˆê¸° í…Œë§ˆ ì ìš©
    applyTheme(getInitialTheme());

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    themeToggle.addEventListener('click', toggleTheme);

    // ì‹œìŠ¤í…œ í…Œë§ˆ ë³€ê²½ ê°ì§€ (ì„ íƒì‚¬í•­)
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      if (!localStorage.getItem('theme')) {
        applyTheme(e.matches ? 'dark' : 'light');
      }
    });
  </script>
</body>
</html>