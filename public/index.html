<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ë„ê°</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤(Seven Knights Re:birth) ì˜ì›… ë„ê° - ëª¨ë“  ì˜ì›…, ëŠ¥ë ¥ì¹˜, ë“±ê¸‰, ì¥ë¹„, ë ˆì´ë“œ ê³µëµ ë“± ìµœì‹  ì •ë³´ë¥¼ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.">
    <meta name="keywords" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤, Seven Knights Re:birth, ì˜ì›… ë„ê°, ì˜ì›… ë°ì´í„°ë² ì´ìŠ¤, ì¥ë¹„ ë„ê°, ë ˆì´ë“œ, ê²Œì„ ê³µëµ, ëª¨ë°”ì¼ ê²Œì„, ë„·ë§ˆë¸”, hero database">
    <meta name="author" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ë„ê°">
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ë„ê° | Seven Knights Re:birth Codex">
    <meta property="og:description" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›… ë„ê°ê³¼ ì¥ë¹„, ë ˆì´ë“œ ê³µëµ ë“± ëª¨ë“  ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.">
    <meta property="og:image" content="https://sk-dogam.app/images/og-image.png">
    <meta property="og:url" content="https://sk-dogam.app/">
    <meta property="og:type" content="website">
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ë„ê° | Seven Knights Re:birth Codex">
    <meta name="twitter:description" content="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ì˜ì›… ë„ê°, ì¥ë¹„, ë ˆì´ë“œ ê³µëµ ë“± ìµœì‹  ì •ë³´ ì œê³µ">
    <meta name="twitter:image" content="https://sk-dogam.app/images/og-image.png">
    <!-- Canonical Link -->
    <link rel="canonical" href="https://sk-dogam.app/" />
    <link rel="stylesheet" href="/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2"></script>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DMD8LXSEQ5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DMD8LXSEQ5');
</script>
  </head>
  <body>
    <div class="layout">
      <header class="header">
        <div class="header-logo">
          <img src="/images/logo.png" alt="ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ë„ê° ë¡œê³ " />
          <div class="header-title">ì„¸ë¸ë‚˜ì´ì¸  ë¦¬ë²„ìŠ¤ ë„ê°</div>
        </div>
      </header>

      <aside class="sidebar-left">
        <nav>
          <ul>
            <li>ì˜ì›… ë„ê°</li>
            <li>ì¥ë¹„ ë„ê°</li>
            <li>ë ˆì´ë“œ ê³µëµ</li>
          </ul>
        </nav>
      </aside>

      <main class="content">
        <div id="heroes"></div>
      </main>

      <aside class="sidebar-right">
        <div>
          <h3>ì •ë ¬ / í•„í„°</h3>
          <div class="filter-section">
            <label for="filter-type">ìœ í˜•</label>
            <select id="filter-type">
              <option value="">ì „ì²´</option>
              <option value="ê³µê²©í˜•">ê³µê²©í˜•</option>
              <option value="ë°©ì–´í˜•">ë°©ì–´í˜•</option>
              <option value="ë§ˆë²•í˜•">ë§ˆë²•í˜•</option>
              <option value="ì§€ì›í˜•">ì§€ì›í˜•</option>
              <option value="ë§ŒëŠ¥í˜•">ë§ŒëŠ¥í˜•</option>
            </select>
          </div>
          <div class="filter-section">
            <label for="filter-rarity">í¬ê·€ë„</label>
            <select id="filter-rarity">
              <option value="">ì „ì²´</option>
              <option value="ì „ì„¤+">ì „ì„¤+</option>
              <option value="ì „ì„¤">ì „ì„¤</option>
              <option value="í¬ê·€">í¬ê·€</option>
              <option value="ê³ ê¸‰">ê³ ê¸‰</option>
            </select>
          </div>
        </div>
      </aside>
    </div>

    <!-- Global Loading Overlay -->
    <div id="global-loading" class="loading-container" aria-hidden="true" style="display:flex;">
      <div class="spinner"></div>
      <div class="loading-text">L O A D I N G</div>
    </div>

    <script>
      function showLoading(on) {
        const el = document.getElementById("global-loading");
        if (!el) return;
        el.style.display = on ? "flex" : "none";
      }

      // Airtable ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
      async function fetchHeroes() {
        showLoading(true);
        try {
          const response = await fetch("/api/heroes");
          const data = await response.json();
          const heroesContainer = document.getElementById("heroes");
          heroesContainer.innerHTML = "";

          // ë°©ì–´ ì½”ë“œ: records í™•ì¸
          if (!data.records || !Array.isArray(data.records)) {
            heroesContainer.textContent = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (records ì—†ìŒ)";
            console.error("ì„œë²„ ì‘ë‹µ:", data);
            return;
          }

          data.records.forEach((record) => {
            const hero = record;
            const card = document.createElement("div");
            card.className = "hero-card";

            // === (êµ¬)ì„¸ë¸ë‚˜ì´ì¸  ì „ìš© data-group ì†ì„± ì¶”ê°€ ===
            if (hero.group) {
              card.setAttribute("data-group", hero.group);
              if (hero.group.includes("(êµ¬)ì„¸ë¸ë‚˜ì´ì¸ ")) {
                card.classList.add("old-sevenknights");
                console.log(`ğŸ’œ (êµ¬)ì„¸ë¸ë‚˜ì´ì¸  ê·¸ë£¹ ê°ì§€ë¨ â†’ ${hero.name}`);
              } else {
                console.log(`ğŸ’› ì¼ë°˜ ê·¸ë£¹ â†’ ${hero.name}`);
              }
            }
            // === (êµ¬)ì„¸ë¸ë‚˜ì´ì¸  ì „ìš© data-group ì†ì„± ì¶”ê°€ ë ===

            // ì´ˆìƒ ì´ë¯¸ì§€ì™€ íƒ€ì… ë°°ì§€ ê°ì‹¸ëŠ” div
            if (hero.portrait) {
                const imgWrapper = document.createElement("div");
                imgWrapper.className = "hero-portrait-wrap";
                imgWrapper.style.position = "relative";

                const img = document.createElement("img");
                img.src = hero.portrait;
                img.alt = hero.name || "ì´ë¯¸ì§€ ì—†ìŒ";
                const rarityClass = (() => {
                  switch (hero.rarity) {
                    case "ì „ì„¤+": return "legendary-plus";
                    case "ì „ì„¤": return "legendary";
                    case "í¬ê·€": return "rare";
                    case "ê³ ê¸‰": return "uncommon";
                    default: return "normal";
                  }
                })();
                img.className = `hero-portrait rarity-${rarityClass}`;
                // hasEffectê°€ trueë©´ ì´ˆìƒí™”ì— ë¹›ë‚˜ëŠ” í…Œë‘ë¦¬ í´ë˜ìŠ¤ ë¶€ì—¬
                if (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1) {
                  img.classList.add("has-effect");
                }
                imgWrapper.appendChild(img);

                // === [DEBUG TEST BLOCK: START] ===
                // ë‹¤ì´ì•„ëª¬ë“œ ë°˜ì§ íš¨ê³¼ (ì²´í¬ë°•ìŠ¤ í•„ë“œ ê¸°ë°˜)
                if (hero.hasEffect) {
                  console.log(`ğŸŸ£ ${hero.name} | group:`, hero.group);
                  const gradientId = `paint0_diamond_${hero.name.replace(/\s/g, '')}_${record.id}`;
                  const starWrapper = document.createElement("div");
                  starWrapper.className = "rarity-diamond-effect";
                  starWrapper.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 100 100" fill="none">
                      <defs>
                        <linearGradient id="${gradientId}" x1="0" y1="0" x2="500" y2="500" gradientUnits="userSpaceOnUse">
                          <stop stop-color="#FFF8E1"/>
                          <stop offset="0.533654" stop-color="#FFE082"/>
                          <stop offset="1" stop-color="#FFB300"/>
                        </linearGradient>
                      </defs>
                      <path d="M99.0854 0.124826C99.6876 -0.259713 100.26 0.312411 99.8752 0.914611C74.5556 40.6083 73.1362 54.5342 90.8173 89.847C91.0858 90.3826 90.384 91.0844 89.8483 90.816L89.847 90.8174C54.5329 73.1375 40.6072 74.5546 0.914577 99.8752C0.312412 100.26 -0.259673 99.6876 0.124792 99.0854C25.4444 59.3918 26.8625 45.4671 9.18167 10.1521C8.9215 9.63314 9.57223 8.95807 10.1001 9.16059L10.1507 9.18308C45.4657 26.8639 59.3905 25.4457 99.0854 0.124826ZM65.703 34.2974C61.9959 35.3198 58.2999 36.037 54.5685 36.4171C48.0147 37.0846 41.7138 36.6839 35.4457 35.4467C36.6829 41.7148 37.0837 48.0156 36.4162 54.5693C36.0363 58.3003 35.3191 61.996 34.2969 65.7027C38.0036 64.6805 41.6993 63.9633 45.4303 63.5834C51.9843 62.9159 58.2853 63.3166 64.5537 64.5539C63.3165 58.2856 62.9157 51.9848 63.5833 45.4307C63.9634 41.6997 64.6808 38.0041 65.703 34.2974Z" fill="url(#${gradientId})"/>
                    </svg>
                  `;

                  try {
                    const stops = starWrapper.querySelectorAll(`#${gradientId} stop`);
                    if (stops && stops.length >= 3) {
                      const isOldSeven = hero.group && hero.group.trim().includes("(êµ¬)ì„¸ë¸ë‚˜ì´ì¸ ");
                      if (isOldSeven) {
                        stops[0].setAttribute("stop-color", "#EEDBFF");
                        stops[1].setAttribute("stop-color", "#C49CFF");
                        stops[2].setAttribute("stop-color", "#9C6BFF");
                        console.log(`ğŸ’œ ë³´ë¼ìƒ‰ ì ìš©ë¨ â†’ ${hero.name}`);
                      } else {
                        stops[0].setAttribute("stop-color", "#FFF8E1");
                        stops[1].setAttribute("stop-color", "#FFE082");
                        stops[2].setAttribute("stop-color", "#FFB300");
                        console.log(`ğŸ’› ì¼ë°˜ í™©ê¸ˆìƒ‰ ìœ ì§€ â†’ ${hero.name}`);
                      }
                    }
                  } catch (e) {
                    console.warn("ê·¸ë¼ë””ì–¸íŠ¸ ì ìš© ì‹¤íŒ¨:", e);
                  }

                  imgWrapper.appendChild(starWrapper);
                }
                // === [DEBUG TEST BLOCK: END] ===

                if (hero.typeImage) {
                  const typeBadge = document.createElement("img");
                  typeBadge.src = hero.typeImage;
                  typeBadge.alt = hero.type || "íƒ€ì… ë°°ì§€";
                  typeBadge.className = "hero-type-badge";
                  imgWrapper.appendChild(typeBadge);
                }

                card.appendChild(imgWrapper);
            }

            // ì´ë¦„
            const name = document.createElement("div");
            name.className = "hero-name";
            name.textContent = hero.name || "ì´ë¦„ ì—†ìŒ";
            card.appendChild(name);

            // ë³„ëª…
            if (hero.nickname) {
                const nickname = document.createElement("div");
                nickname.className = "hero-nickname";
                nickname.textContent = `${hero.nickname}`;
                card.appendChild(nickname);
            }

            // ì†Œì† ê·¸ë£¹ (ìˆ¨ê¹€ ì²˜ë¦¬)
            // if (hero.group) {
            //    const group = document.createElement("div");
            //    group.className = "hero-group";
            //    group.textContent = hero.group;
            //    card.appendChild(group);
            //}

            // ë“±ê¸‰ (ìˆ¨ê¹€ ì²˜ë¦¬)
            // if (hero.rarity) {
            //     const rarity = document.createElement("div");
            //     rarity.className = "hero-rarity";
            //     rarity.textContent = hero.rarity;
            //     card.appendChild(rarity);
            // }

            // íƒ€ì… í…ìŠ¤íŠ¸ í‘œì‹œ ë¶€ë¶„ ì œê±°

            // ì¹´ë“œ í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™ ë° ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ì €ì¥
            const heroId = record.id;
            card.addEventListener("click", () => {
              sessionStorage.setItem('scrollPosition', window.scrollY);
              window.location.href = `/hero.html?id=${heroId}`;
            });
            heroesContainer.appendChild(card);
            });
        } catch (error) {
          console.error("ì—ëŸ¬:", error);
          document.getElementById("heroes").textContent = "ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜";
        } finally {
          showLoading(false);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        const savedScroll = sessionStorage.getItem('scrollPosition');
        if (savedScroll) {
          window.scrollTo(0, parseInt(savedScroll));
          sessionStorage.removeItem('scrollPosition');
        }
      });

      fetchHeroes();
    </script>

  </body>
</html>