<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>세븐나이츠 리버스 도감</title>
    <!-- SEO Meta Tags -->
    <meta name="description" content="세븐나이츠 리버스(Seven Knights Re:birth) 영웅 도감 - 모든 영웅, 능력치, 등급, 장비, 레이드 공략 등 최신 정보를 한눈에 확인하세요.">
    <meta name="keywords" content="세븐나이츠 리버스, Seven Knights Re:birth, 영웅 도감, 영웅 데이터베이스, 장비 도감, 레이드, 게임 공략, 모바일 게임, 넷마블, hero database">
    <meta name="author" content="세븐나이츠 리버스 도감">
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="세븐나이츠 리버스 도감 | Seven Knights Re:birth Codex">
    <meta property="og:description" content="세븐나이츠 리버스 영웅 도감과 장비, 레이드 공략 등 모든 정보를 제공합니다.">
    <meta property="og:image" content="https://sk-dogam.app/images/og-image.png">
    <meta property="og:url" content="https://sk-dogam.app/">
    <meta property="og:type" content="website">
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="세븐나이츠 리버스 도감 | Seven Knights Re:birth Codex">
    <meta name="twitter:description" content="세븐나이츠 리버스 영웅 도감, 장비, 레이드 공략 등 최신 정보 제공">
    <meta name="twitter:image" content="https://sk-dogam.app/images/og-image.png">
    <!-- Canonical Link -->
    <link rel="canonical" href="https://sk-dogam.app/" />
    <link rel="stylesheet" href="/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/@phosphor-icons/web@2.1.2"></script>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DMD8LXSEQ5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DMD8LXSEQ5');
</script>
  </head>
  <body>
    <div class="layout">
      <header class="header">
        <div class="header-logo">
          <img src="/images/logo.png" alt="세븐나이츠 리버스 도감 로고" />
        </div>
      </header>

      <aside class="sidebar-left">
        <nav>
          <ul>
            <li>영웅 도감</li>
            <li>장비 도감</li>
            <li>레이드 공략</li>
          </ul>
        </nav>
      </aside>

      <main class="content">
        <div id="heroes"></div>
      </main>

      <aside class="sidebar-right">
        <div>
          <h3>정렬 / 필터</h3>
          <div class="filter-section">
            <label for="filter-type">유형</label>
            <select id="filter-type">
              <option value="">전체</option>
              <option value="공격형">공격형</option>
              <option value="방어형">방어형</option>
              <option value="마법형">마법형</option>
              <option value="지원형">지원형</option>
              <option value="만능형">만능형</option>
            </select>
          </div>
          <div class="filter-section">
            <label for="filter-rarity">희귀도</label>
            <select id="filter-rarity">
              <option value="">전체</option>
              <option value="전설+">전설+</option>
              <option value="전설">전설</option>
              <option value="희귀">희귀</option>
              <option value="고급">고급</option>
            </select>
          </div>
        </div>
      </aside>
    </div>

    <!-- Global Loading Overlay -->
    <div id="global-loading" class="loading-container" aria-hidden="true" style="display:flex;">
      <div class="spinner"></div>
      <div class="loading-text">L O A D I N G</div>
    </div>

    <script>
      function showLoading(on) {
        const el = document.getElementById("global-loading");
        if (!el) return;
        el.style.display = on ? "flex" : "none";
      }

      // Airtable 데이터 불러오기
      async function fetchHeroes() {
        showLoading(true);
        try {
          const response = await fetch("/api/heroes");
          const data = await response.json();
          const heroesContainer = document.getElementById("heroes");
          heroesContainer.innerHTML = "";

          // 방어 코드: records 확인
          if (!data.records || !Array.isArray(data.records)) {
            heroesContainer.textContent = "데이터를 불러오지 못했습니다. (records 없음)";
            console.error("서버 응답:", data);
            return;
          }

          data.records.forEach((record) => {
            const hero = record;
            const card = document.createElement("div");
            card.className = "hero-card";

            // 초상 이미지와 타입 배지 감싸는 div
            if (hero.portrait) {
                const imgWrapper = document.createElement("div");
                imgWrapper.className = "hero-portrait-wrap";
                imgWrapper.style.position = "relative";

                const img = document.createElement("img");
                img.src = hero.portrait;
                img.alt = hero.name || "이미지 없음";
                const rarityClass = (() => {
                  switch (hero.rarity) {
                    case "전설+": return "legendary-plus";
                    case "전설": return "legendary";
                    case "희귀": return "rare";
                    case "고급": return "uncommon";
                    default: return "normal";
                  }
                })();
                img.className = `hero-portrait rarity-${rarityClass}`;
                // hasEffect가 true면 초상화에 빛나는 테두리 클래스 부여
                if (hero.hasEffect === true || hero.hasEffect === "true" || hero.hasEffect === 1) {
                  img.classList.add("has-effect");
                }
                imgWrapper.appendChild(img);

                // 다이아몬드 반짝 효과 (체크박스 필드 기반)
                if (hero.hasEffect) {
                  const starWrapper = document.createElement("div");
                  starWrapper.className = "rarity-diamond-effect";
                  starWrapper.innerHTML = `
                    <svg class="spark-star" width="24" height="24" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <defs>
                        <radialGradient id="sparkGradient" cx="50%" cy="50%" r="50%">
                          <stop offset="0%" stop-color="#FFDDB0" />
                          <stop offset="50%" stop-color="#FFBB55" />
                          <stop offset="100%" stop-color="#FF6666" />
                        </radialGradient>
                      </defs>
                      <path d="M99.0854 0.124826C99.6876 -0.259713 100.26 0.312411 99.8752 0.914611C74.5556 40.6083 73.1362 54.5342 90.8173 89.847C91.0858 90.3826 90.384 91.0844 89.8483 90.816L89.847 90.8174C54.5329 73.1375 40.6072 74.5546 0.914577 99.8752C0.312412 100.26 -0.259673 99.6876 0.124792 99.0854C25.4444 59.3918 26.8625 45.4671 9.18167 10.1521C8.9215 9.63314 9.57223 8.95807 10.1001 9.16059L10.1507 9.18308C45.4657 26.8639 59.3905 25.4457 99.0854 0.124826ZM65.703 34.2974C61.9959 35.3198 58.2999 36.037 54.5685 36.4171C48.0147 37.0846 41.7138 36.6839 35.4457 35.4467C36.6829 41.7148 37.0837 48.0156 36.4162 54.5693C36.0363 58.3003 35.3191 61.996 34.2969 65.7027C38.0036 64.6805 41.6993 63.9633 45.4303 63.5834C51.9843 62.9159 58.2853 63.3166 64.5537 64.5539C63.3165 58.2856 62.9157 51.9848 63.5833 45.4307C63.9634 41.6997 64.6808 38.0041 65.703 34.2974Z" fill="url(#sparkGradient)"/>
                    </svg>
                  `;
                  imgWrapper.appendChild(starWrapper);
                }

                if (hero.typeImage) {
                  const typeBadge = document.createElement("img");
                  typeBadge.src = hero.typeImage;
                  typeBadge.alt = hero.type || "타입 배지";
                  typeBadge.className = "hero-type-badge";
                  imgWrapper.appendChild(typeBadge);
                }

                card.appendChild(imgWrapper);
            }

            // 이름
            const name = document.createElement("div");
            name.className = "hero-name";
            name.textContent = hero.name || "이름 없음";
            card.appendChild(name);

            // 별명
            if (hero.nickname) {
                const nickname = document.createElement("div");
                nickname.className = "hero-nickname";
                nickname.textContent = `${hero.nickname}`;
                card.appendChild(nickname);
            }

            // 소속 그룹
            if (hero.group) {
                const group = document.createElement("div");
                group.className = "hero-group";
                group.textContent = hero.group;
                card.appendChild(group);
            }

            // 등급 (숨김 처리)
            // if (hero.rarity) {
            //     const rarity = document.createElement("div");
            //     rarity.className = "hero-rarity";
            //     rarity.textContent = hero.rarity;
            //     card.appendChild(rarity);
            // }

            // 타입 텍스트 표시 부분 제거

            // 카드 클릭 시 상세 페이지로 이동 및 스크롤 위치 저장
            const heroId = record.id;
            card.addEventListener("click", () => {
              sessionStorage.setItem('scrollPosition', window.scrollY);
              window.location.href = `/hero.html?id=${heroId}`;
            });
            heroesContainer.appendChild(card);
            });
        } catch (error) {
          console.error("에러:", error);
          document.getElementById("heroes").textContent = "데이터 불러오기 오류";
        } finally {
          showLoading(false);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        const savedScroll = sessionStorage.getItem('scrollPosition');
        if (savedScroll) {
          window.scrollTo(0, parseInt(savedScroll));
          sessionStorage.removeItem('scrollPosition');
        }
      });

      fetchHeroes();
    </script>

  </body>
</html>